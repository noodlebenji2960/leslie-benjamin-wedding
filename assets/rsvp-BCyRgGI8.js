import{a as d,R as Qe,y as qe,w as Ze}from"./chunk-EPOLDU6W-C9vtjoJn.js";import{j as t}from"./jsx-runtime-u17CrQMm.js";import{u as W}from"./useTranslation-DvHpW7Xw.js";import{I as E}from"./Icon-fSrDZDb7.js";import{m as O,A as ae,M as et,T as tt}from"./Modal-Sal8OyIs.js";import{u as _e}from"./lenis-react-DQp2-cqK.js";import{u as Me}from"./LanguageContext-BPaMIK5g.js";import{u as rt}from"./LayoutContext-CEUgmXuB.js";import{u as Ne}from"./AnalyticsContext-qLPwaGr0.js";import{u as at}from"./useWeddingData-DmPkR6aw.js";import"./i18next-BDvusv7y.js";const st=/^[\w\-.]+@([\w-]+\.)+[\w-]{2,4}$/,nt=/[^\w\-+.@]/,it=/[^\w\-+.@]/g,ot=({form:e,onChange:r})=>{const{t:s}=W(["rsvp"]),[a,n]=d.useState(!1);d.useRef(null);const h=a?(m=>m.trim()?st.test(m)?null:s("rsvp:errors.invalidEmail"):s("rsvp:errors.required"))(e.email):null,v=a&&!h&&e.email.trim()!=="",l=m=>{m.key.length===1&&nt.test(m.key)&&m.preventDefault()},c=m=>{m.target.value=m.target.value.replace(it,"").toLowerCase(),r(m)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{htmlFor:"email",children:[s("rsvp:email")," ",t.jsx("span",{className:"required",children:"*"})]}),t.jsx("input",{id:"email",name:"email",type:"email",value:e.email,onKeyDown:l,onChange:c,onBlur:()=>n(!0),className:`form-input ${h?"form-input-invalid":v?"form-input-valid":""}`,required:!0,autoComplete:"email",tabIndex:0}),h&&t.jsx("div",{className:"field-error",children:h})]}),t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{htmlFor:"attending",children:[s("rsvp:attending")," ",t.jsx("span",{className:"required",children:"*"})]}),t.jsxs("select",{id:"attending",name:"attending",value:e.attending,onChange:r,className:`form-input ${e.attending?"form-input-valid":""}`,required:!0,autoComplete:"off",tabIndex:0,children:[t.jsx("option",{value:"",children:s("rsvp:select")}),t.jsx("option",{value:"yes",children:s("rsvp:yes")}),t.jsx("option",{value:"no",children:s("rsvp:no")})]})]})]})},Te=({index:e,guest:r,onUpdate:s,onRemove:a,onConfirm:n,onEditToggle:o,isDraft:h=!1,isRostered:v=!1,isEditing:l=!1})=>{const{t:c}=W(["rsvp"]),[m,i]=d.useState(!1),[p,f]=d.useState(!1),[y,x]=d.useState(!1),[S,T]=d.useState(!1),_=d.useRef(null),b=r.firstName.trim()&&r.lastName.trim(),k=h||l,u=r.firstName||r.lastName?`${r.firstName} ${r.lastName}`.trim():c("rsvp:newGuest"),R=j=>j.replace(/[^a-zA-ZÀ-ÿ\s'-]/g,""),w=(j,g)=>j.slice(0,g),$=j=>j.charAt(0).toUpperCase()+j.slice(1),G=(j,g)=>{const P=w(R($(g)),30);s?.(e,j,P)},L=(j,g,P)=>{const F=P?w(g,P):g;s?.(e,j,F)},M=()=>{if(!b){x(!0);return}n&&n(),x(!1),i(!1),f(!1),setTimeout(()=>_.current?.focus(),0)},Y=()=>{o?.(l?null:e)},A=j=>{h&&j.key==="Enter"&&!(j.target instanceof HTMLTextAreaElement)&&(j.preventDefault(),M())};return d.useEffect(()=>{r.dietary&&i(!0),r.note&&f(!0)},[r.dietary,r.note]),d.useEffect(()=>{!l&&v&&(r.dietary||i(!1),r.note||f(!1))},[l,v,r.dietary,r.note]),d.useEffect(()=>{l&&setTimeout(()=>_.current?.focus(),0)},[l]),t.jsxs(t.Fragment,{children:[t.jsxs(O.div,{className:`guest-card ${y&&!b?"invalid":""} ${v&&!l?"guest-card--locked guest-card--viewing":""} ${l?"guest-card--editing":""}`,role:"group","aria-label":u,onKeyDown:A,layout:"position",initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",stiffness:400,damping:30,layout:{type:"spring",stiffness:500}},children:[v&&!l?t.jsxs("div",{className:"inputs-container",children:[t.jsxs("p",{className:"guest-name",children:[r.firstName," ",r.lastName]}),r.dietary&&t.jsxs("p",{className:"guest-meta",children:[t.jsx(E.Food,{"aria-hidden":"true"}),r.dietary]}),r.note&&t.jsxs("p",{className:"guest-meta",children:[t.jsx(E.Note,{"aria-hidden":"true"}),r.note]})]}):t.jsxs("div",{className:"inputs-container",children:[t.jsxs("div",{className:"form-row",children:[t.jsx("input",{ref:_,type:"text",name:"firstName",placeholder:c("rsvp:firstName"),"aria-label":c("rsvp:firstName"),"aria-required":"true","aria-invalid":y&&!r.firstName.trim()?"true":void 0,value:r.firstName,onChange:j=>G("firstName",j.target.value),maxLength:30}),t.jsx("input",{type:"text",name:"lastName",placeholder:c("rsvp:lastName"),"aria-label":c("rsvp:lastName"),"aria-required":"true","aria-invalid":y&&!r.lastName.trim()?"true":void 0,value:r.lastName,onChange:j=>G("lastName",j.target.value),maxLength:30})]}),t.jsxs(ae,{children:[m&&t.jsxs(O.div,{className:"form-row",initial:{opacity:0,scaleY:.8,originY:0},animate:{opacity:1,scaleY:1,transition:{type:"spring",stiffness:400,damping:30}},exit:{opacity:0,scaleY:.8,transition:{duration:.15}},children:[t.jsx("input",{type:"text",placeholder:c("rsvp:dietaryPlaceholder"),"aria-label":c("rsvp:dietaryPlaceholder"),value:r.dietary,onChange:j=>L("dietary",j.target.value,100),maxLength:100}),t.jsx("button",{type:"button",className:"close-btn","aria-label":c("rsvp:removeDietary"),onClick:()=>{i(!1),L("dietary","")},children:"×"})]}),p&&t.jsxs(O.div,{className:"form-row",initial:{opacity:0,scaleY:.8,originY:0},animate:{opacity:1,scaleY:1,transition:{type:"spring",stiffness:400,damping:30}},exit:{opacity:0,scaleY:.8,transition:{duration:.15}},children:[t.jsx("textarea",{placeholder:c("rsvp:notePlaceholder"),"aria-label":c("rsvp:notePlaceholder"),value:r.note||"",onChange:j=>L("note",j.target.value,200),maxLength:200}),t.jsx("button",{type:"button",className:"close-btn","aria-label":c("rsvp:removeNote"),onClick:()=>{f(!1),L("note","")},children:"×"})]})]})]}),t.jsxs("div",{className:"guest-card-actions",role:"toolbar","aria-label":c("rsvp:guestActions",{name:u}),children:[k&&!m&&t.jsx("button",{type:"button",className:"three-dots-btn",onClick:()=>i(!0),title:c("rsvp:addDietary"),"aria-label":c("rsvp:addDietary"),children:t.jsx(E.Food,{"aria-hidden":"true"})}),k&&!p&&t.jsx("button",{type:"button",className:"three-dots-btn",onClick:()=>f(!0),title:c("rsvp:addNote"),"aria-label":c("rsvp:addNote"),children:t.jsx(E.Note,{"aria-hidden":"true"})}),h?t.jsx(O.button,{type:"button",className:"form-btn add-guest-btn",onClick:M,whileHover:{scale:1.02},title:c("rsvp:addGuest"),"aria-label":c("rsvp:addGuest"),children:t.jsx(E.Add,{"aria-hidden":"true"})}):t.jsxs(t.Fragment,{children:[l&&t.jsx("button",{type:"button",className:"remove-guest",onClick:()=>T(!0),"aria-label":c("rsvp:removeGuestConfirm",{name:`${r.firstName} ${r.lastName}`}),children:t.jsx(E.Delete,{"aria-hidden":"true"})}),t.jsx("button",{type:"button",className:`three-dots-btn ${l?"confirm-guest-edit":""}`,onClick:Y,"aria-label":c(l?"rsvp:doneEditing":"rsvp:editGuest"),"aria-pressed":l,title:c(l?"rsvp:doneEditing":"rsvp:editGuest"),children:l?t.jsx(E.Check,{"aria-hidden":"true"}):t.jsx(E.Edit,{"aria-hidden":"true"})})]})]})]}),t.jsx(et,{isOpen:S,onClose:()=>T(!1),closeOnBackdropClick:!0,showCloseButton:!1,"aria-labelledby":"confirm-modal-title",children:t.jsxs("div",{className:"confirm-modal",role:"alertdialog","aria-modal":"true","aria-labelledby":"confirm-modal-title",children:[t.jsx("p",{id:"confirm-modal-title",children:c("rsvp:removeGuestConfirm",{name:`${r.firstName} ${r.lastName}`})}),t.jsxs("div",{className:"confirm-modal-actions",children:[t.jsx("button",{type:"button",className:"button",onClick:()=>T(!1),children:c("rsvp:cancel")}),t.jsx("button",{type:"button",className:"button button--danger",onClick:()=>{a?.(e),T(!1)},children:c("rsvp:remove")})]})]})})]})},Ce={firstName:"",lastName:"",dietary:"",note:""},ct=({guests:e,onGuestsChange:r})=>{const{t:s}=W(["rsvp"]),[a,n]=d.useState(Ce),[o,h]=d.useState(null),v=d.useCallback(f=>{r(e.filter((y,x)=>x!==f)),h(null)},[e,r]),l=d.useCallback((f,y,x)=>e.some((S,T)=>T!==x&&S.firstName.trim().toLowerCase()===f.trim().toLowerCase()&&S.lastName.trim().toLowerCase()===y.trim().toLowerCase()),[e]),c=d.useCallback(()=>{!a.firstName.trim()||!a.lastName.trim()||l(a.firstName,a.lastName)||(r([...e,a]),n(Ce))},[a,e,l,r]),m=d.useCallback((f,y,x)=>{const S={...e[f],[y]:x};(y==="firstName"||y==="lastName")&&l(S.firstName,S.lastName,f)||r(e.map((T,_)=>_===f?S:T))},[e,l,r]),i=d.useCallback((f,y)=>{n(x=>({...x,[f]:y}))},[]),p=d.useCallback(f=>{h(f)},[]);return t.jsxs("div",{className:"guests-section","aria-label":s("rsvp:guestsTitle.plural"),children:[t.jsxs("div",{className:"add-guest-section",children:[t.jsx(O.label,{className:"add-another-label",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},children:e.length===0?s("rsvp:addGuest"):s("rsvp:addAnother")}),t.jsx(Te,{index:e.length,guest:a,onUpdate:(f,y,x)=>i(y,x),onConfirm:c,isDraft:!0},"draft")]}),t.jsxs(ae,{children:[e.length>0&&t.jsxs("div",{className:"guests-count",children:[e.length," ",s(e.length===1?"rsvp:guestsTitle.singular":"rsvp:guestsTitle.plural")]}),e.map((f,y)=>t.jsx(Te,{index:y,guest:f,onUpdate:m,onRemove:v,onEditToggle:p,isEditing:o===y,isRostered:!0},`roster-${y}`))]})]})},lt=({attending:e,guests:r,nonAttendingName:s,onChange:a,onGuestsChange:n})=>{const{t:o}=W(["rsvp"]);return e==="yes"?t.jsx(ct,{guests:r,onGuestsChange:n,required:!0}):t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{htmlFor:"nonAttendingName",children:[o("rsvp:yourName")," ",t.jsx("span",{className:"required",children:"*"})]}),t.jsx("input",{id:"nonAttendingName",name:"nonAttendingName",type:"text",value:s,onChange:a,className:"form-input",required:!0,autoComplete:"name",spellCheck:!1,tabIndex:0})]})},dt=({player:e,onStop:r,onAdd:s,isAdded:a,canAddMore:n,formatTime:o,progressPercent:h,t:v})=>{const l=d.useRef(null),{state:{fixedOffsetY:c},actions:{setFixedOffset:m,resetFixedOffset:i}}=rt();return e.song?(d.useEffect(()=>{if(e.song){const p=l.current?.getBoundingClientRect().height;m(p*-1)}else i();return()=>{i()}},[e,l]),t.jsxs(O.div,{ref:l,className:"mini-player",role:"region","aria-label":v("rsvp:musicRequest.nowPlayingAriaLabel"),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",stiffness:400,damping:30},children:[t.jsx(O.img,{src:e.song.artworkUrl100,alt:`${e.song.trackName} album art`,className:"mini-player__artwork",initial:{opacity:0},animate:{opacity:1},transition:{duration:.15},loading:"lazy"},e.song.artworkUrl100),t.jsxs("div",{className:"mini-player__info",children:[t.jsx(O.span,{className:"mini-player__track",initial:{opacity:0,x:6},animate:{opacity:1,x:0},transition:{duration:.15},children:e.song.trackName},`track-${e.song.trackName}`),t.jsx(O.span,{className:"mini-player__artist",initial:{opacity:0,x:6},animate:{opacity:1,x:0},transition:{duration:.15,delay:.03},children:e.song.artistName},`artist-${e.song.artistName}`),t.jsx("div",{className:"mini-player__progress-bar",role:"progressbar","aria-valuenow":h,"aria-valuemin":0,"aria-valuemax":100,children:t.jsx("div",{className:"mini-player__progress-fill",style:{width:`${h}%`}})})]}),t.jsxs("span",{className:"mini-player__time",children:[o(e.currentTime)," / ",o(e.duration)]}),t.jsxs("div",{className:"mini-player__actions",children:[t.jsx("button",{className:"mini-player__add",onClick:()=>s(e.song),disabled:a||!n,"aria-label":a?`${e.song.trackName} already added`:v("rsvp:musicRequest.addAriaLabel",{songName:e.song.trackName}),children:a?t.jsx(E.Tick,{}):t.jsx(E.Add,{})}),t.jsx("button",{className:"mini-player__stop",onClick:r,"aria-label":v("rsvp:musicRequest.stopAriaLabel",{songName:e.song.trackName}),children:t.jsx(E.Stop,{})})]})]},e.url)):null},ut=({showManualEntry:e,manualTrack:r,manualArtist:s,onManualTrackChange:a,onManualArtistChange:n,onAddManual:o,onCancel:h,onToggle:v,t:l})=>t.jsxs("div",{className:"manual-entry-form",children:[t.jsx("input",{type:"text",value:r,onChange:c=>a(c.target.value),placeholder:l("rsvp:musicRequest.manualEntry.songPlaceholder"),className:"form-input","aria-label":l("rsvp:musicRequest.manualEntry.songPlaceholder"),onKeyDown:c=>{c.key==="Enter"&&o()}}),t.jsx("input",{type:"text",value:s,onChange:c=>n(c.target.value),placeholder:l("rsvp:musicRequest.manualEntry.artistPlaceholder"),className:"form-input","aria-label":l("rsvp:musicRequest.manualEntry.artistPlaceholder"),onKeyDown:c=>{c.key==="Enter"&&o()}}),t.jsxs("div",{className:"manual-entry-actions",children:[t.jsx("button",{type:"button",className:"button",onClick:h,children:l("rsvp:musicRequest.manualEntry.cancelButton")}),t.jsx("button",{type:"button",className:"button button--primary",onClick:o,disabled:!r.trim()||!s.trim(),children:l("rsvp:musicRequest.manualEntry.addButton")})]})]}),pt=({currentPage:e,totalPages:r,onPageChange:s})=>{const a=()=>{const o=[];for(let l=1;l<=r;l++)(l===1||l===r||l>=e-1&&l<=e+1)&&o.push(l);const h=[];let v=null;for(const l of o)v!==null&&l-v===2?h.push(v+1):v!==null&&l-v>2&&h.push("…"),h.push(l),v=l;return h};return t.jsxs("div",{className:"dd-pagination",children:[t.jsx("button",{className:"dd-pagination__btn",onClick:()=>s(e-1),disabled:e===1,"aria-label":"Previous page",children:"‹"}),a().map((n,o)=>n==="…"?t.jsx("span",{className:"dd-pagination__ellipsis",children:"…"},`ellipsis-${o}`):t.jsx("button",{className:`dd-pagination__btn${n===e?" dd-pagination__btn--active":""}`,onClick:()=>typeof n=="number"&&s(n),disabled:n===e,"aria-current":n===e?"page":void 0,children:n},n)),t.jsx("button",{className:"dd-pagination__btn",onClick:()=>s(e+1),disabled:e===r,"aria-label":"Next page",children:"›"})]})},mt=({isOpen:e,setIsOpen:r,songQuery:s,artistQuery:a,onSongChange:n,onArtistChange:o,onClear:h,suggestions:v,isSearching:l,error:c,addedSongKeys:m,canAddMore:i,player:p,onPlayToggle:f,onAddSong:y,formatTime:x,currentPage:S,totalPages:T,itemsPerPage:_,totalItems:b,onPageChange:k,onItemsPerPageChange:u,t:R})=>{const w=d.useRef(null),$=d.useRef(null),G=d.useRef(null),[L,M]=d.useState(-1),Y=_e(),A=!!(s||a);d.useEffect(()=>{r(!!A)},[A]),d.useEffect(()=>{const g=P=>{w.current&&!w.current.contains(P.target)&&r(!1)};return document.addEventListener("pointerdown",g),()=>document.removeEventListener("pointerdown",g)},[]),d.useEffect(()=>{M(-1)},[v,S]);const j=d.useCallback(g=>{if(e){if(g.key==="ArrowDown")g.preventDefault(),M(P=>Math.min(P+1,v.length-1));else if(g.key==="ArrowUp")g.preventDefault(),M(P=>Math.max(P-1,-1));else if(g.key==="Escape")r(!1),G.current?.blur();else if(g.key==="Enter"&&L>=0){g.preventDefault();const P=v[L];P&&!m.has(P.id)&&i&&y(P)}}},[e,v,L,m,i]);return d.useEffect(()=>{L>=0&&$.current&&$.current.querySelectorAll(".dropdown-suggestion-item")[L]?.scrollIntoView({block:"nearest"})},[L]),d.useEffect(()=>{if(e&&w.current&&v.length>0){const g=setTimeout(()=>{w.current&&Y?.scrollTo(w.current,{offset:document.documentElement.clientHeight/4*-1})},100);return()=>clearTimeout(g)}},[e,v]),t.jsxs("div",{className:"search-dropdown",ref:w,onKeyDown:j,children:[t.jsxs("div",{className:"search-dropdown__inputs",children:[t.jsxs("div",{className:"search-dropdown__input-wrapper",children:[t.jsx("span",{className:"search-dropdown__icon search-dropdown__icon--song",children:t.jsxs("svg",{viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M6 13V3l7-1v10"}),t.jsx("circle",{cx:"4",cy:"13",r:"2"}),t.jsx("circle",{cx:"11",cy:"12",r:"2"})]})}),t.jsx("input",{ref:G,type:"text",value:s,onChange:g=>n(g.target.value),onFocus:()=>A&&r(!0),placeholder:R("rsvp:musicRequest.searchPlaceholder.song"),className:"form-input search-dropdown__input","aria-label":R("rsvp:musicRequest.searchPlaceholder.song"),"aria-expanded":e,"aria-haspopup":"listbox","aria-autocomplete":"list",role:"combobox","aria-controls":"suggestions-listbox","aria-activedescendant":L>=0?`suggestion-item-${v[L]?.id}`:void 0}),s&&t.jsx("button",{className:"search-dropdown__clear-single",onClick:()=>n(""),"aria-label":"Clear song search",tabIndex:-1,children:"✕"})]}),t.jsxs("div",{className:"search-dropdown__input-wrapper",children:[t.jsx("span",{className:"search-dropdown__icon search-dropdown__icon--artist",children:t.jsxs("svg",{viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"8",cy:"5",r:"3"}),t.jsx("path",{d:"M2 14c0-3.314 2.686-5 6-5s6 1.686 6 5"})]})}),t.jsx("input",{type:"text",value:a,onChange:g=>o(g.target.value),onFocus:()=>A&&r(!0),placeholder:R("rsvp:musicRequest.searchPlaceholder.artist"),className:"form-input search-dropdown__input","aria-label":R("rsvp:musicRequest.searchPlaceholder.artist")}),a&&t.jsx("button",{className:"search-dropdown__clear-single",onClick:()=>o(""),"aria-label":"Clear artist search",tabIndex:-1,children:"✕"})]})]}),t.jsx(ae,{children:e&&t.jsxs(O.div,{className:"search-dropdown__panel",initial:{opacity:0,y:-6,scaleY:.97},animate:{opacity:1,y:0,scaleY:1},exit:{opacity:0,y:-6,scaleY:.97},transition:{duration:.15,ease:"easeOut"},style:{transformOrigin:"top center"},children:[b>0&&t.jsxs("div",{className:"search-dropdown__panel-header",children:[t.jsxs("span",{className:"search-dropdown__total",children:[b," ",b===1?"result":"results"]}),t.jsxs("div",{className:"search-dropdown__pagination-top",children:[T>1&&t.jsxs("div",{className:"search-dropdown__page-select",children:[t.jsx("label",{htmlFor:"dd-page-select",children:"Page"}),t.jsx("select",{id:"dd-page-select",value:S,onChange:g=>k(parseInt(g.target.value)),className:"form-select",children:Array.from({length:T},(g,P)=>P+1).map(g=>t.jsx("option",{value:g,children:g},g))})]}),t.jsx("div",{className:"search-dropdown__per-page",children:t.jsx("select",{value:_,onChange:g=>u(parseInt(g.target.value)),className:"form-select","aria-label":"Results per page",children:yt.map(g=>t.jsxs("option",{value:g,children:[g," / page"]},g))})})]})]}),l&&t.jsxs("div",{role:"status","aria-live":"polite",className:"search-dropdown__status",children:[t.jsx("span",{className:"search-dropdown__spinner","aria-hidden":"true"}),R("rsvp:musicRequest.searching")]}),c&&!l&&t.jsx("div",{role:"alert",className:"search-dropdown__error",children:c}),!l&&v.length>0&&t.jsx("ul",{id:"suggestions-listbox",ref:$,className:"search-dropdown__list",role:"listbox","aria-label":"Song suggestions",children:v.map((g,P)=>{const F=m.has(g.id),V=p.url===g.previewUrl,I=P===L;return t.jsxs(O.li,{id:`suggestion-item-${g.id}`,className:`dropdown-suggestion-item${I?" dropdown-suggestion-item--active":""}${F?" dropdown-suggestion-item--added":""}`,role:"option","aria-selected":F,onMouseEnter:()=>M(P),initial:{opacity:0},animate:{opacity:1},transition:{duration:.1,delay:P*.012},children:[t.jsxs("div",{className:"dd-item__artwork",children:[t.jsx("img",{src:g.artworkUrl100,alt:"",className:"dd-item__artwork-gray",loading:"lazy"}),t.jsx("img",{src:g.artworkUrl100,alt:`${g.trackName} album art`,className:"dd-item__artwork-color",loading:"lazy"}),g.previewUrl&&t.jsx("button",{onClick:K=>{K.stopPropagation(),f(g)},className:`dd-item__play-btn${V?" dd-item__play-btn--playing":""}`,"aria-label":V?R("rsvp:musicRequest.stopAriaLabel",{songName:g.trackName}):R("rsvp:musicRequest.playAriaLabel",{songName:g.trackName}),tabIndex:-1,children:V?t.jsx(E.Stop,{}):t.jsx(E.Play,{})})]}),t.jsxs("div",{className:"dd-item__info",children:[t.jsx("span",{className:"dd-item__track",children:g.trackName}),t.jsx("span",{className:"dd-item__artist",children:g.artistName})]}),t.jsx("button",{className:"dd-item__add-btn",onClick:K=>{K.stopPropagation(),y(g)},disabled:F||!i,"aria-label":F?`${g.trackName} already added`:R("rsvp:musicRequest.addAriaLabel",{songName:g.trackName}),children:F?t.jsx(E.Tick,{}):t.jsx(E.Add,{})})]},g.id)})}),T>1&&t.jsx("div",{className:"search-dropdown__panel-footer",children:t.jsx(pt,{currentPage:S,totalPages:T,onPageChange:k})})]})})]})},ht=({songs:e,playerUrl:r,onPlayToggle:s,onRemove:a,t:n})=>t.jsxs("div",{className:"added-songs-section",children:[t.jsx("div",{className:"added-songs-header",children:t.jsx("span",{className:"song-count",children:n("rsvp:musicRequest.addedSongsHeader",{count:e.length,max:X})})}),t.jsx("ul",{className:"added-songs-list",children:e.map(o=>t.jsxs("li",{className:"added-song-item",children:[t.jsxs("div",{className:"song-info",children:[t.jsx("img",{src:o.artworkUrl100,alt:`${o.trackName} album art`,className:"song-artwork-small",loading:"lazy"}),t.jsxs("div",{className:"song-text",children:[t.jsx("span",{className:"song-name",children:o.trackName}),t.jsx("span",{className:"artist-name",children:o.artistName})]})]}),t.jsxs("div",{className:"song-actions",children:[t.jsx("button",{onClick:()=>a(e.indexOf(o)),className:"remove-btn","aria-label":n("rsvp:musicRequest.removeAriaLabel",{songName:o.trackName}),children:t.jsx(E.Delete,{})}),o.previewUrl&&t.jsx("button",{onClick:()=>s(o),className:"play-btn-small","aria-label":r===o.previewUrl?n("rsvp:musicRequest.stopAriaLabel",{songName:o.trackName}):n("rsvp:musicRequest.playAriaLabel",{songName:o.trackName}),children:r===o.previewUrl?t.jsx(E.Stop,{}):t.jsx(E.Play,{})})]})]},o.id))})]}),ee={song:null,url:null,currentTime:0,duration:0,isTransitioning:!1},ft="https://placehold.co/100x100?text=♪",X=10,vt=400,gt=200,yt=[20,50,100],ce={song:"songTerm",artist:"artistTerm",all:"allArtistTerm"},bt=({musicRequests:e=[],onChange:r})=>{const{locale:s}=Me(),[a,n]=d.useState(""),[o,h]=d.useState(""),[v,l]=d.useState([]),[c,m]=d.useState(20),[i,p]=d.useState(1),[f,y]=d.useState(!1),[x,S]=d.useState(ee),[T,_]=d.useState(null),[b,k]=d.useState(!1),[u,R]=d.useState(""),[w,$]=d.useState(""),[G,L]=d.useState(!1),[M,Y]=d.useState(!1),{t:A}=W(["home","common","rsvp"]),j=d.useRef(null),g=d.useRef(),P=d.useRef(),F=_e(),V=d.useMemo(()=>new Set(e.map(N=>N.id)),[e]),I=e.length<X,K=e.length>=X,we=d.useCallback(N=>{const H=Math.floor(N/60).toString().padStart(2,"0"),D=Math.floor(N%60).toString().padStart(2,"0");return`${H}:${D}`},[]),Se=d.useCallback(()=>!a&&o?ce.artist:a&&!o?ce.song:ce.all,[a,o]);d.useEffect(()=>{const N=new Audio;j.current=N;const H=()=>{S(B=>({...B,duration:N.duration,isTransitioning:!1}))},D=()=>{S(B=>({...B,currentTime:N.currentTime}))},Q=()=>{S(ee)},Z=B=>{console.error("Audio error:",B),S(ee),_(A("rsvp:musicRequest.errors.playbackFailed")),setTimeout(()=>_(null),5e3)};return N.addEventListener("loadedmetadata",H),N.addEventListener("timeupdate",D),N.addEventListener("ended",Q),N.addEventListener("error",Z),()=>{N.pause(),N.src="",N.load(),N.removeEventListener("loadedmetadata",H),N.removeEventListener("timeupdate",D),N.removeEventListener("ended",Q),N.removeEventListener("error",Z),j.current=null}},[A]);const J=d.useCallback(()=>{j.current&&(j.current.pause(),j.current.currentTime=0),S(ee)},[]);d.useEffect(()=>{L(x.song!==null)},[x.song]),d.useEffect(()=>()=>{g.current&&clearTimeout(g.current),P.current&&P.current.abort()},[]),d.useEffect(()=>{const N=`${a} ${o}`.trim();if(g.current&&clearTimeout(g.current),P.current&&P.current.abort(),!N){l([]),_(null);return}y(!0),_(null),P.current=new AbortController;const H=Se();return g.current=setTimeout(async()=>{try{const D=new URL("https://itunes.apple.com/search");D.searchParams.append("term",N),D.searchParams.append("entity","song"),D.searchParams.append("attribute",H),D.searchParams.append("limit",gt.toString()),D.searchParams.append("lang",s);const Q=await fetch(D.toString(),{signal:P.current?.signal});if(!Q.ok)throw new Error("Failed to fetch songs");const Z=await Q.json();l(Z.results?.map(B=>({id:String(B.trackId),trackName:B.trackName,artistName:B.artistName,artworkUrl100:B.artworkUrl100,previewUrl:B.previewUrl}))||[]),Z.results?.length===0&&_(A("rsvp:musicRequest.errors.noResults")),p(1)}catch(D){D.name!=="AbortError"&&(console.error("Search error:",D),_(A("rsvp:musicRequest.errors.searchFailed")))}finally{y(!1)}},vt),()=>{g.current&&clearTimeout(g.current)}},[a,o,A,s,Se]);const ne=Math.ceil(v.length/c)||1;d.useEffect(()=>{i>ne&&p(ne)},[i,ne]);const We=d.useMemo(()=>{const N=(i-1)*c;return v.slice(N,N+c)},[v,i,c]),ke=d.useCallback(N=>{if(!(!N.previewUrl||!j.current)){if(x.url===N.previewUrl){J();return}j.current.pause(),j.current.src=N.previewUrl,j.current.load(),S({song:N,url:N.previewUrl,currentTime:0,duration:0,isTransitioning:!0}),j.current.play().catch(H=>{console.error("Playback failed:",H),S(ee),_(A("rsvp:musicRequest.errors.playbackFailed")),setTimeout(()=>_(null),5e3)})}},[x.url,J,A]),Re=d.useCallback(N=>{!V.has(N.id)&&I&&(r([...e,N].slice(0,X)),Y(!1))},[V,I,e,r,F]),Ye=d.useCallback(()=>{if(!u.trim()||!w.trim()||!I)return;const N={id:crypto.randomUUID?crypto.randomUUID():`manual-${Date.now()}-${Math.random()}`,trackName:u.trim(),artistName:w.trim(),artworkUrl100:ft};V.has(N.id)||r([...e,N].slice(0,X)),R(""),$(""),k(!1)},[u,w,I,V,e,r,F]),Ke=d.useCallback(N=>{const H=[...e],D=H[N];H.splice(N,1),r(H),x.url===D?.previewUrl&&J()},[e,r,x.url,J]),Je=d.useCallback(()=>{n(""),h(""),J()},[J]),Xe=x.duration>0?x.currentTime/x.duration*100:0;return d.useEffect(()=>{const N=f||!!T||v.length>0;Y(N)},[]),t.jsxs("div",{className:"music-request-manager",children:[t.jsxs("div",{className:"search-label",children:[t.jsx(O.label,{className:"add-another-label",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},children:b?A("rsvp:addSong"):e.length===0?A("rsvp:searchSong"):A("rsvp:addAnother")}),!b&&t.jsx("button",{type:"button",className:"manual-entry-toggle",onClick:()=>k(!0),children:A("rsvp:musicRequest.manualEntry.toggle")})]}),b&&(a||o)&&I?t.jsx(ut,{showManualEntry:b,manualTrack:u,manualArtist:w,onManualTrackChange:R,onManualArtistChange:$,onAddManual:Ye,onCancel:()=>{k(!1),R(""),$("")},onToggle:()=>k(!0),t:A}):t.jsx(mt,{isOpen:M,setIsOpen:Y,songQuery:a,artistQuery:o,onSongChange:n,onArtistChange:h,onClear:Je,suggestions:We,isSearching:f,error:T,addedSongKeys:V,canAddMore:I,player:x,onPlayToggle:ke,onAddSong:Re,formatTime:we,currentPage:i,totalPages:ne,itemsPerPage:c,totalItems:v.length,onPageChange:p,onItemsPerPageChange:m,t:A}),e.length>0&&t.jsx(ht,{songs:e,playerUrl:x.url,onPlayToggle:ke,onRemove:Ke,t:A}),K&&t.jsx("div",{className:"limit-message",role:"status",children:A("rsvp:musicRequest.limitMessage",{max:X})}),t.jsx(ae,{mode:"wait",children:G&&x.song&&t.jsx(dt,{player:x,onStop:J,onAdd:Re,isAdded:V.has(x.song.id),canAddMore:I,formatTime:we,progressPercent:Xe,t:A})})]})},xt=Qe.memo(bt),_t=({musicRequest:e,onChange:r})=>t.jsx(xt,{musicRequests:e,onChange:s=>r({target:{name:"musicRequest",value:s}})}),Nt=({attending:e,notes:r,onChange:s})=>t.jsx("div",{className:"form-group",children:t.jsx("textarea",{id:"notes",name:"notes",value:r,onChange:s,className:"form-input",tabIndex:0})});var le={exports:{}},de,Ee;function jt(){if(Ee)return de;Ee=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return de=e,de}var ue,Ae;function wt(){if(Ae)return ue;Ae=1;var e=jt();function r(){}function s(){}return s.resetWarningCache=r,ue=function(){function a(h,v,l,c,m,i){if(i!==e){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}a.isRequired=a;function n(){return a}var o={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:n,element:a,elementType:a,instanceOf:n,node:a,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:s,resetWarningCache:r};return o.PropTypes=o,o},ue}var Pe;function St(){return Pe||(Pe=1,le.exports=wt()()),le.exports}var kt=St();const U=qe(kt);var Rt=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function fe(){return fe=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},fe.apply(this,arguments)}function Tt(e,r){if(e==null)return{};var s={},a=Object.keys(e),n,o;for(o=0;o<a.length;o++)n=a[o],!(r.indexOf(n)>=0)&&(s[n]=e[n]);return s}function ie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ct(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,ve(e,r)}function ve(e,r){return ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,n){return a.__proto__=n,a},ve(e,r)}var oe=(function(e){Ct(r,e);function r(){var a;return a=e.call(this)||this,a.handleExpired=a.handleExpired.bind(ie(a)),a.handleErrored=a.handleErrored.bind(ie(a)),a.handleChange=a.handleChange.bind(ie(a)),a.handleRecaptchaRef=a.handleRecaptchaRef.bind(ie(a)),a}var s=r.prototype;return s.getCaptchaFunction=function(n){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[n]:this.props.grecaptcha[n]:null},s.getValue=function(){var n=this.getCaptchaFunction("getResponse");return n&&this._widgetId!==void 0?n(this._widgetId):null},s.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},s.execute=function(){var n=this.getCaptchaFunction("execute");if(n&&this._widgetId!==void 0)return n(this._widgetId);this._executeRequested=!0},s.executeAsync=function(){var n=this;return new Promise(function(o,h){n.executionResolve=o,n.executionReject=h,n.execute()})},s.reset=function(){var n=this.getCaptchaFunction("reset");n&&this._widgetId!==void 0&&n(this._widgetId)},s.forceReset=function(){var n=this.getCaptchaFunction("reset");n&&n()},s.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},s.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},s.handleChange=function(n){this.props.onChange&&this.props.onChange(n),this.executionResolve&&(this.executionResolve(n),delete this.executionReject,delete this.executionResolve)},s.explicitRender=function(){var n=this.getCaptchaFunction("render");if(n&&this._widgetId===void 0){var o=document.createElement("div");this._widgetId=n(o,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(o)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},s.componentDidMount=function(){this.explicitRender()},s.componentDidUpdate=function(){this.explicitRender()},s.handleRecaptchaRef=function(n){this.captcha=n},s.render=function(){var n=this.props;n.sitekey,n.onChange,n.theme,n.type,n.tabindex,n.onExpired,n.onErrored,n.size,n.stoken,n.grecaptcha,n.badge,n.hl,n.isolated;var o=Tt(n,Rt);return d.createElement("div",fe({},o,{ref:this.handleRecaptchaRef}))},r})(d.Component);oe.displayName="ReCAPTCHA";oe.propTypes={sitekey:U.string.isRequired,onChange:U.func,grecaptcha:U.object,theme:U.oneOf(["dark","light"]),type:U.oneOf(["image","audio"]),tabindex:U.number,onExpired:U.func,onErrored:U.func,size:U.oneOf(["compact","normal","invisible"]),stoken:U.string,hl:U.string,badge:U.oneOf(["bottomright","bottomleft","inline"]),isolated:U.bool};oe.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};var pe={exports:{}},C={};var Le;function Et(){if(Le)return C;Le=1;var e=typeof Symbol=="function"&&Symbol.for,r=e?Symbol.for("react.element"):60103,s=e?Symbol.for("react.portal"):60106,a=e?Symbol.for("react.fragment"):60107,n=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,h=e?Symbol.for("react.provider"):60109,v=e?Symbol.for("react.context"):60110,l=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,m=e?Symbol.for("react.forward_ref"):60112,i=e?Symbol.for("react.suspense"):60113,p=e?Symbol.for("react.suspense_list"):60120,f=e?Symbol.for("react.memo"):60115,y=e?Symbol.for("react.lazy"):60116,x=e?Symbol.for("react.block"):60121,S=e?Symbol.for("react.fundamental"):60117,T=e?Symbol.for("react.responder"):60118,_=e?Symbol.for("react.scope"):60119;function b(u){if(typeof u=="object"&&u!==null){var R=u.$$typeof;switch(R){case r:switch(u=u.type,u){case l:case c:case a:case o:case n:case i:return u;default:switch(u=u&&u.$$typeof,u){case v:case m:case y:case f:case h:return u;default:return R}}case s:return R}}}function k(u){return b(u)===c}return C.AsyncMode=l,C.ConcurrentMode=c,C.ContextConsumer=v,C.ContextProvider=h,C.Element=r,C.ForwardRef=m,C.Fragment=a,C.Lazy=y,C.Memo=f,C.Portal=s,C.Profiler=o,C.StrictMode=n,C.Suspense=i,C.isAsyncMode=function(u){return k(u)||b(u)===l},C.isConcurrentMode=k,C.isContextConsumer=function(u){return b(u)===v},C.isContextProvider=function(u){return b(u)===h},C.isElement=function(u){return typeof u=="object"&&u!==null&&u.$$typeof===r},C.isForwardRef=function(u){return b(u)===m},C.isFragment=function(u){return b(u)===a},C.isLazy=function(u){return b(u)===y},C.isMemo=function(u){return b(u)===f},C.isPortal=function(u){return b(u)===s},C.isProfiler=function(u){return b(u)===o},C.isStrictMode=function(u){return b(u)===n},C.isSuspense=function(u){return b(u)===i},C.isValidElementType=function(u){return typeof u=="string"||typeof u=="function"||u===a||u===c||u===o||u===n||u===i||u===p||typeof u=="object"&&u!==null&&(u.$$typeof===y||u.$$typeof===f||u.$$typeof===h||u.$$typeof===v||u.$$typeof===m||u.$$typeof===S||u.$$typeof===T||u.$$typeof===_||u.$$typeof===x)},C.typeOf=b,C}var Oe;function At(){return Oe||(Oe=1,pe.exports=Et()),pe.exports}var me,Ie;function Pt(){if(Ie)return me;Ie=1;var e=At(),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},n={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},o={};o[e.ForwardRef]=a,o[e.Memo]=n;function h(y){return e.isMemo(y)?n:o[y.$$typeof]||r}var v=Object.defineProperty,l=Object.getOwnPropertyNames,c=Object.getOwnPropertySymbols,m=Object.getOwnPropertyDescriptor,i=Object.getPrototypeOf,p=Object.prototype;function f(y,x,S){if(typeof x!="string"){if(p){var T=i(x);T&&T!==p&&f(y,T,S)}var _=l(x);c&&(_=_.concat(c(x)));for(var b=h(y),k=h(x),u=0;u<_.length;++u){var R=_[u];if(!s[R]&&!(S&&S[R])&&!(k&&k[R])&&!(b&&b[R])){var w=m(x,R);try{v(y,R,w)}catch{}}}}return y}return me=f,me}var Lt=Pt();const Ot=qe(Lt);function ge(){return ge=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},ge.apply(this,arguments)}function It(e,r){if(e==null)return{};var s={},a=Object.keys(e),n,o;for(o=0;o<a.length;o++)n=a[o],!(r.indexOf(n)>=0)&&(s[n]=e[n]);return s}function $t(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.__proto__=r}var z={},qt=0;function Mt(e,r){return r=r||{},function(a){var n=a.displayName||a.name||"Component",o=(function(v){$t(l,v);function l(m,i){var p;return p=v.call(this,m,i)||this,p.state={},p.__scriptURL="",p}var c=l.prototype;return c.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+qt++),this.__scriptLoaderID},c.setupScriptURL=function(){return this.__scriptURL=typeof e=="function"?e():e,this.__scriptURL},c.asyncScriptLoaderHandleLoad=function(i){var p=this;this.setState(i,function(){return p.props.asyncScriptOnLoad&&p.props.asyncScriptOnLoad(p.state)})},c.asyncScriptLoaderTriggerOnScriptLoaded=function(){var i=z[this.__scriptURL];if(!i||!i.loaded)throw new Error("Script is not loaded.");for(var p in i.observers)i.observers[p](i);delete window[r.callbackName]},c.componentDidMount=function(){var i=this,p=this.setupScriptURL(),f=this.asyncScriptLoaderGetScriptLoaderID(),y=r,x=y.globalName,S=y.callbackName,T=y.scriptId;if(x&&typeof window[x]<"u"&&(z[p]={loaded:!0,observers:{}}),z[p]){var _=z[p];if(_&&(_.loaded||_.errored)){this.asyncScriptLoaderHandleLoad(_);return}_.observers[f]=function(w){return i.asyncScriptLoaderHandleLoad(w)};return}var b={};b[f]=function(w){return i.asyncScriptLoaderHandleLoad(w)},z[p]={loaded:!1,observers:b};var k=document.createElement("script");k.src=p,k.async=!0;for(var u in r.attributes)k.setAttribute(u,r.attributes[u]);T&&(k.id=T);var R=function($){if(z[p]){var G=z[p],L=G.observers;for(var M in L)$(L[M])&&delete L[M]}};S&&typeof window<"u"&&(window[S]=function(){return i.asyncScriptLoaderTriggerOnScriptLoaded()}),k.onload=function(){var w=z[p];w&&(w.loaded=!0,R(function($){return S?!1:($(w),!0)}))},k.onerror=function(){var w=z[p];w&&(w.errored=!0,R(function($){return $(w),!0}))},document.body.appendChild(k)},c.componentWillUnmount=function(){var i=this.__scriptURL;if(r.removeOnUnmount===!0)for(var p=document.getElementsByTagName("script"),f=0;f<p.length;f+=1)p[f].src.indexOf(i)>-1&&p[f].parentNode&&p[f].parentNode.removeChild(p[f]);var y=z[i];y&&(delete y.observers[this.asyncScriptLoaderGetScriptLoaderID()],r.removeOnUnmount===!0&&delete z[i])},c.render=function(){var i=r.globalName,p=this.props;p.asyncScriptOnLoad;var f=p.forwardedRef,y=It(p,["asyncScriptOnLoad","forwardedRef"]);return i&&typeof window<"u"&&(y[i]=typeof window[i]<"u"?window[i]:void 0),y.ref=f,d.createElement(a,y)},l})(d.Component),h=d.forwardRef(function(v,l){return d.createElement(o,ge({},v,{forwardedRef:l}))});return h.displayName="AsyncScriptLoader("+n+")",h.propTypes={asyncScriptOnLoad:U.func},Ot(h,a)}}var ye="onloadcallback",Dt="grecaptcha";function be(){return typeof window<"u"&&window.recaptchaOptions||{}}function Ft(){var e=be(),r=e.useRecaptchaNet?"recaptcha.net":"www.google.com";return e.enterprise?"https://"+r+"/recaptcha/enterprise.js?onload="+ye+"&render=explicit":"https://"+r+"/recaptcha/api.js?onload="+ye+"&render=explicit"}const Ut=Mt(Ft,{callbackName:ye,globalName:Dt,attributes:be().nonce?{nonce:be().nonce}:{}})(oe),Vt=({form:e})=>{const{t:r}=W(["rsvp"]);return t.jsx("div",{className:"review-card",children:t.jsxs("div",{className:"review-card__inner",children:[t.jsxs("div",{className:"review-card__field",children:[t.jsx("span",{className:"review-card__field-label",children:r("rsvp:email")}),t.jsx("span",{className:"review-card__field-value",children:e.email})]}),e.attending==="yes"&&e.guests.length>0&&t.jsxs("div",{className:"review-card__field",children:[t.jsxs("span",{className:"review-card__field-label",children:[r("rsvp:review.numberAttending")," (",e.guests.length,")"]}),t.jsx("ul",{className:"review-card__guests",children:e.guests.map((s,a)=>t.jsxs("li",{className:"review-card__field-value",children:[s.firstName," ",s.lastName,s.dietary&&t.jsxs("span",{className:"review-card__dietary",children:[" ","(",s.dietary,")"]})]},a))})]}),e.attending==="no"&&t.jsxs("div",{className:"review-card__field",children:[t.jsx("span",{className:"review-card__field-label",children:r("rsvp:name")}),t.jsx("span",{className:"review-card__field-value",children:e.nonAttendingName})]}),e.notes&&t.jsxs("div",{className:"review-card__field",children:[t.jsx("span",{className:"review-card__field-label",children:r("rsvp:messageToBrideGroom")}),t.jsxs("p",{className:"review-card__note review-card__field-value",children:['"',e.notes,'"']})]}),e.attending==="yes"&&e.musicRequest&&e.musicRequest.length>0&&t.jsxs("div",{className:"review-card__field",children:[t.jsx("span",{className:"review-card__field-label",children:r("rsvp:musicRequest")}),t.jsx("ul",{className:"review-card__songs",children:e.musicRequest.map((s,a)=>t.jsxs("li",{className:"review-card__song",children:[t.jsx("img",{src:s.artworkUrl100,alt:s.trackName,className:"review-card__song-art"}),t.jsxs("span",{className:"review-card__field-value",children:[s.trackName," — ",s.artistName]})]},a))})]})]})})},Ht=({form:e,onChange:r,captchaToken:s,error:a,recaptchaRef:n,setCaptchaToken:o,isDev:h})=>{const{locale:v}=Me(),{t:l}=W(["rsvp"]);return t.jsxs(t.Fragment,{children:[t.jsx(Vt,{form:e}),t.jsx("div",{className:"form-group form-group--consent",children:t.jsxs("label",{className:"consent-label",children:[t.jsx("input",{type:"checkbox",name:"termsAccepted",checked:!!e.termsAccepted,onChange:r,className:"consent-checkbox",tabIndex:0}),t.jsxs("span",{className:"consent-text",children:[l("rsvp:terms.iAgree")," ",t.jsx("a",{href:`/${v}/legal/terms`,target:"_blank",rel:"noopener noreferrer",children:l("rsvp:terms.termsLinkText")})," ",l("rsvp:terms.and")," ",t.jsx("a",{href:`/${v}/legal/privacy`,target:"_blank",rel:"noopener noreferrer",children:l("rsvp:terms.privacyLinkText")}),"."]})]})}),!h&&t.jsx(Ut,{sitekey:"6Lcy_mcsAAAAADoT-ibwy1RvePEHG4xJ87D0fdse",onChange:c=>o(c),ref:n,style:{display:"inline-block",width:"100%",marginTop:"1rem"}}),!h&&!s&&a&&t.jsx("div",{className:"field-error",children:l("rsvp:errors.captchaRequired")})]})},Gt=!1,te={initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},Bt=e=>{const{currentStep:r,form:s,isClient:a,currentStepObj:n}=e;return t.jsx(t.Fragment,{children:t.jsxs(ae,{mode:"wait",children:[r===0&&t.jsx(O.div,{variants:te,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:t.jsx(ot,{...e})},"step0"),n.key==="guestsOrName"&&t.jsx(O.div,{variants:te,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:t.jsx(lt,{attending:s.attending,guests:s.guests,nonAttendingName:s.nonAttendingName??"",onChange:e.onChange,onGuestsChange:e.onGuestsChange})},"guestsOrName"),n.key==="musicRequest"&&s.attending==="yes"&&t.jsx(O.div,{variants:te,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:t.jsx(_t,{musicRequest:s.musicRequest||[],onChange:e.onChange})},"musicRequest"),n.key==="notes"&&t.jsx(O.div,{variants:te,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:t.jsx(Nt,{attending:s.attending,notes:s.notes,onChange:e.onChange})},"notes"),n.key==="review"&&a&&t.jsx(O.div,{variants:te,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:t.jsx(Ht,{form:s,onChange:e.onChange,captchaToken:e.captchaToken,error:e.error,recaptchaRef:e.recaptchaRef,setCaptchaToken:e.setCaptchaToken,isDev:Gt})},"review")]})})},zt=({submittedRef:e,guestEmail:r})=>{const{t:s}=W(["home","common","rsvp"]),[a,n]=d.useState(!1);return d.useEffect(()=>{const o=setTimeout(()=>n(!0),50),h=setInterval(()=>{n(!1),setTimeout(()=>n(!0),55)},1e4);return()=>{clearTimeout(o),clearInterval(h)}},[]),t.jsxs(O.div,{className:"rsvp-page container",ref:e,tabIndex:-1,role:"status","aria-live":"polite",initial:{opacity:0,scale:.9,y:30},animate:{opacity:1,scale:1,y:0,transition:{type:"spring",stiffness:300,damping:25,duration:.6}},children:[t.jsx(O.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:400,damping:20,delay:1},className:"heart-animated","aria-hidden":"true",style:{fontSize:"4rem",marginBottom:"1.5rem",display:"flex",justifyContent:"center"},children:t.jsxs("svg",{viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",children:[t.jsx("defs",{children:t.jsx("path",{id:"heart",d:"M12 4.435c-1.989-5.399-12-4.597-12 3.568 0 4.068 3.06 9.481 12 14.997 8.94-5.516 12-10.929 12-14.997 0-8.118-10-8.999-12-3.568z"})}),t.jsx(O.use,{xlinkHref:"#heart",initial:{opacity:0,scale:.33},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:15},style:{transformOrigin:"center"}},a?"on":"off")]})}),t.jsx(O.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},style:{textAlign:"center",marginBottom:"1rem"},children:s("rsvp:thankYou")}),t.jsx(O.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},style:{textAlign:"center",maxWidth:"500px",margin:"0 auto 2rem",lineHeight:1.6},children:s("rsvp:confirmation",{guestEmail:r})})]})};function Wt(e){const r=Ne(),[s,a]=d.useState({...e,musicRequest:e.musicRequest||"",termsAccepted:!1}),[n,o]=d.useState(0),[h,v]=d.useState(null),[l,c]=d.useState(!1),m=_e(()=>{}),{t:i}=W(["rsvp"]),p=[{key:"contactAndAttendance",required:!0,icon:t.jsx(E.Contact,{}),stepName:i("rsvp:steps.contactAndAttendance.stepTitle")},{key:"guestsOrName",required:!0,icon:t.jsx(E.People,{}),completionIcon:t.jsx("p",{children:s.guests.length}),stepName:i("rsvp:steps.guestsOrName.stepTitle")},{key:"musicRequest",required:!1,icon:t.jsx(E.Music.default,{}),completionIcon:t.jsx("p",{children:s.musicRequest?.length}),stepName:i("rsvp:steps.musicRequest.stepTitle")},{key:"notes",required:!1,icon:t.jsx(E.LoveLetter,{}),completionIcon:t.jsx(E.Heart.default,{}),stepName:i("rsvp:steps.notes.stepTitle")},{key:"review",required:!0,icon:t.jsx(E.Checklist,{}),completionIcon:t.jsx(E.Tick,{}),stepName:i("rsvp:steps.review.stepTitle")}];(s.attending==="no"||s.attending===void 0)&&p.splice(2,1);const f=p[n];return{form:s,setForm:a,currentStep:n,currentStepObj:f,steps:p,error:h,setError:v,hasValidGuests:l,handleChange:b=>{const{name:k}=b.target,u=b.target instanceof HTMLInputElement&&b.target.type==="checkbox"?b.target.checked:b.target.value;a(R=>({...R,[k]:u})),v(null)},handleGuestsChange:b=>{a(k=>({...k,guests:b})),c(b.some(k=>k.firstName.trim()&&k.lastName.trim()))},nextStep:()=>{r.event("rsvp_step_complete",{event_label:f.key,step_number:n+1,step_name:f.key}),o(b=>b+1),m?.scrollTo(0)},prevStep:()=>{r.event("rsvp_step_back",{event_label:f.key,step_number:n+1,step_name:f.key}),o(b=>b-1),m?.scrollTo(0)},goToStep:b=>{o(b),m?.scrollTo(0)}}}class se{constructor(r=0,s="Network Error"){this.status=r,this.text=s}}const Yt=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,r)=>Promise.resolve(localStorage.setItem(e,r)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},q={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:Yt()},je=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},Kt=(e,r="https://api.emailjs.com")=>{if(!e)return;const s=je(e);q.publicKey=s.publicKey,q.blockHeadless=s.blockHeadless,q.storageProvider=s.storageProvider,q.blockList=s.blockList,q.limitRate=s.limitRate,q.origin=s.origin||r},De=async(e,r,s={})=>{const a=await fetch(q.origin+e,{method:"POST",headers:s,body:r}),n=await a.text(),o=new se(a.status,n);if(a.ok)return o;throw o},Fe=(e,r,s)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!r||typeof r!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!s||typeof s!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Jt=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},Ue=e=>e.webdriver||!e.languages||e.languages.length===0,Ve=()=>new se(451,"Unavailable For Headless Browser"),Xt=(e,r)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof r!="string")throw"The BlockList watchVariable has to be a string"},Qt=e=>!e.list?.length||!e.watchVariable,Zt=(e,r)=>e instanceof FormData?e.get(r):e[r],He=(e,r)=>{if(Qt(e))return!1;Xt(e.list,e.watchVariable);const s=Zt(r,e.watchVariable);return typeof s!="string"?!1:e.list.includes(s)},Ge=()=>new se(403,"Forbidden"),er=(e,r)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(r&&typeof r!="string")throw"The LimitRate ID has to be a non-empty string"},tr=async(e,r,s)=>{const a=Number(await s.get(e)||0);return r-Date.now()+a},Be=async(e,r,s)=>{if(!r.throttle||!s)return!1;er(r.throttle,r.id);const a=r.id||e;return await tr(a,r.throttle,s)>0?!0:(await s.set(a,Date.now().toString()),!1)},ze=()=>new se(429,"Too Many Requests"),rr=async(e,r,s,a)=>{const n=je(a),o=n.publicKey||q.publicKey,h=n.blockHeadless||q.blockHeadless,v=n.storageProvider||q.storageProvider,l={...q.blockList,...n.blockList},c={...q.limitRate,...n.limitRate};return h&&Ue(navigator)?Promise.reject(Ve()):(Fe(o,e,r),Jt(s),s&&He(l,s)?Promise.reject(Ge()):await Be(location.pathname,c,v)?Promise.reject(ze()):De("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:o,service_id:e,template_id:r,template_params:s}),{"Content-type":"application/json"}))},ar=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},sr=e=>typeof e=="string"?document.querySelector(e):e,nr=async(e,r,s,a)=>{const n=je(a),o=n.publicKey||q.publicKey,h=n.blockHeadless||q.blockHeadless,v=q.storageProvider||n.storageProvider,l={...q.blockList,...n.blockList},c={...q.limitRate,...n.limitRate};if(h&&Ue(navigator))return Promise.reject(Ve());const m=sr(s);Fe(o,e,r),ar(m);const i=new FormData(m);return He(l,i)?Promise.reject(Ge()):await Be(location.pathname,c,v)?Promise.reject(ze()):(i.append("lib_version","4.4.1"),i.append("service_id",e),i.append("template_id",r),i.append("user_id",o),De("/api/v1.0/email/send-form",i))},xe={init:Kt,send:rr,sendForm:nr,EmailJSResponseStatus:se},ir="gVksEDEDoKBjB0TJU",$e="service_vvuhisc",or="template_4m25aki",cr="template_g1m154k",lr="template_u0pm2au";xe.init(ir);function dr(e,r,s=0){const a=Ne(),[n,o]=d.useState(!1),[h,v]=d.useState(!1),[l,c]=d.useState(null),m=async()=>{if(console.log("Submitting RSVP...",{form:e,captchaToken:r}),!e.termsAccepted){const i="Please accept the Terms & Conditions and Privacy Policy.";c(i),a.event("rsvp_submit_error",{event_label:"validation_error",error_message:i,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!!r});return}if(!r){const i="Please complete reCAPTCHA.";c(i),a.event("rsvp_submit_error",{event_label:"validation_error",error_message:i,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!1});return}if(!e.email){const i="Email is required.";c(i),a.event("rsvp_submit_error",{event_label:"validation_error",error_message:i,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!!r});return}if(!e.attending){const i="Please indicate if you're attending.";c(i),a.event("rsvp_submit_error",{event_label:"validation_error",error_message:i,error_type:"validation_error",current_step:s,has_captcha_token:!!r});return}if(e.attending==="yes"&&e.guests.length===0){const i="Please add at least one guest.";c(i),a.event("rsvp_submit_error",{event_label:"validation_error",error_message:i,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!!r});return}if(e.attending==="no"&&!e.nonAttendingName){const i="Please provide your name.";c(i),a.event("rsvp_submit_error",{event_label:"validation_error",error_message:i,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!!r});return}o(!0),c(null);try{const i=e.attending==="yes"?e.guests.map((_,b)=>`${b+1}. ${_.firstName} ${_.lastName}`+(_.dietary?` - Dietary: ${_.dietary}`:"")+(_.note?` - Note: ${_.note}`:"")).join(`
`):`Not attending: ${e.nonAttendingName}`,p=(()=>{if(!e.musicRequest)return"None";const _=e.musicRequest;return!Array.isArray(_)||_.length===0?"None":_.map((b,k)=>`${k+1}. ${b.trackName} — ${b.artistName}`).join(`
`)})(),f={email:e.email,attending:e.attending,guestsCount:e.attending==="yes"?e.guests.length:1,guests:i,notes:e.notes||"None",musicRequest:p,termsAccepted:e.termsAccepted?"Yes — Terms & Conditions and Privacy Policy accepted":"No",recaptchaToken:r};console.log("Sending email with params:",f);const y=await xe.send($e,or,f);console.log("Notification sent:",y);const S=(document.documentElement.lang??"es")==="en"?cr:lr,T=await xe.send($e,S,f);console.log("Auto-reply sent:",T),a.event("rsvp_submit_success",{event_label:`RSVP ${e.attending==="yes"?"Accepted":"Declined"}`,attending:e.attending,guest_count:e.attending==="yes"?e.guests.length:1,dietary_requirements:e.guests[0]?.dietary||"none",music_request:p,terms_accepted:!0,locale:document.documentElement.lang}),a.event("conversion",{event_label:"RSVP Completed",send_to:"AW-CONVERSION-ID"}),a.event("rsvp_confirmation_view",{event_label:"Viewed confirmation page"}),a.event("page_view",{page_title:"RSVP Confirmation",page_location:window.location.href,page_path:"/rsvp/confirmation"}),v(!0)}catch(i){console.error("Submission error:",i);const p=i?.text||i?.message||"Failed to submit RSVP. Please try again.",f=i?.text?"emailjs_error":"network_error";c(p),a.event("rsvp_submit_error",{event_label:f,error_message:p,error_type:f,current_step:s,attending_status:e.attending,has_captcha_token:!!r}),a.event("exception",{description:`RSVP Error: ${f} - ${p}`,fatal:!1})}finally{o(!1)}};return d.useEffect(()=>{l&&console.error("RSVP Error:",l)},[l]),{submit:m,sending:n,submitted:h,error:l,setError:c,setSubmitted:v}}function ur(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&!("$$typeof"in e)&&("component"in e||"icon"in e||"key"in e)}function pr(e){return typeof e=="number"?Array.from({length:e},()=>({node:null,meta:null})):e.map(r=>ur(r)?{node:r.component??r.icon??null,meta:r}:{node:r,meta:null})}const mr=({currentStep:e,steps:r,goToStep:s,stepDataMap:a})=>{const n=pr(r),o=n.length,h=Math.max(0,Math.min(e,o-1)),v=o>1?h/(o-1)*100:100;return t.jsx("div",{className:"progress-bar-container",role:"progressbar","aria-valuenow":h,"aria-valuemin":0,"aria-valuemax":o-1,"aria-label":n[h]?.meta?.stepName?`Step ${h+1}: ${n[h].meta.stepName}`:n[h]?.meta?.key?`Step ${h+1}: ${n[h].meta.key}`:`Step ${h+1} of ${o}`,children:t.jsxs("div",{className:"progress-bar",children:[t.jsx(O.div,{className:"progress-bar__fill",animate:{width:`${v}%`},transition:{duration:.7,ease:"easeInOut"}}),t.jsx("div",{className:"progress-bar__steps",children:n.map(({node:l,meta:c},m)=>{const i=m<h,p=m===h,f=c?.key?a?.[c.key]??!1:!1;return t.jsxs(O.div,{className:"progress-step",title:c?.stepName??c?.key,onClick:()=>{i&&s(m)},style:{position:"absolute",left:`${o>1?m/(o-1)*100:50}%`,cursor:i?"pointer":"default"},transformTemplate:({scale:y})=>`translate(-50%, -50%) scale(${y??1})`,animate:{backgroundColor:i?"var(--color-primary)":"var(--color-white)",color:i?"var(--color-white)":"var(--color-border)",borderColor:p||i?"var(--color-primary)":"var(--color-border)",borderStyle:"solid"},transition:{duration:.25,ease:"easeInOut"},children:[l,t.jsx("div",{className:`progress-step-status-icon ${i?"":"hidden"}`,children:c.completionIcon&&f?c.completionIcon:f?t.jsx(E.Tick,{}):t.jsx(E.Close,{})})]},m)})})]})})};let he=!1,re=!1;const Sr=Ze(function(){const{t:r,ready:s}=W(["home","common","rsvp"]),a=Ne(),[n,o]=d.useState(!1),[h,v]=d.useState(null),l=d.useRef(null),c=at(),{form:m,currentStep:i,currentStepObj:p,steps:f,error:y,handleChange:x,handleGuestsChange:S,nextStep:T,prevStep:_,goToStep:b,hasValidGuests:k}=Wt({email:"",attending:"",guests:[],nonAttendingName:"",notes:"",website:""}),{submit:u,sending:R,submitted:w,error:$,setSubmitted:G}=dr(m,h,i),L=d.useRef(null),M=d.useRef(null),Y=d.useRef(null),A=y||$;if(d.useEffect(()=>{he||(a.event("rsvp_start",{event_label:"User started RSVP form"}),he=!0),re=!1;const I=()=>{!w&&!re&&(a.event("rsvp_abandonment",{event_label:`Abandoned at ${p.key}`,step_number:i+1,step_name:p.key}),re=!0)};return window.addEventListener("beforeunload",I),()=>{window.removeEventListener("beforeunload",I),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{!window.location.pathname.includes("/rsvp")&&(!w&&!re&&(a.event("rsvp_abandonment",{event_label:`Abandoned at ${p.key}`,step_number:i+1,step_name:p.key}),re=!0),he=!1),l.current=null},100)}},[i,p,f,w,a]),d.useEffect(()=>o(!0),[]),d.useEffect(()=>{A&&L.current&&(L.current.scrollIntoView({behavior:"smooth",block:"center"}),L.current.focus()),w&&M.current&&M.current.focus()},[A,w]),!s)return t.jsx("div",{className:"loading",children:r("common:loading")});if(w)return t.jsx(zt,{onReset:()=>G(!1),submittedRef:M,guestEmail:m.email});const j=()=>i===0?!m.attending||!m.email:i===1?m.attending==="yes"?!k:!m.nonAttendingName:i===2||i===3?!1:i===4?!h||!m.termsAccepted:!1,g=r(`rsvp:steps.${p.key}.stepTitle`),P=t.jsx(tt,{i18nKey:`rsvp:steps.${p.key}.stepText`,values:{bride:c.bride.firstName,groom:c.groom.firstName}}),F=I=>I==="contactAndAttendance"?!!m.email||!!m.attending:I==="guestsOrName"?m.attending==="yes"?Array.isArray(m.guests)&&m.guests.some(K=>K.firstName.trim()&&K.lastName.trim()):!!m.nonAttendingName?.trim():I==="musicRequest"?Array.isArray(m.musicRequest)&&m.musicRequest.length>0:I==="notes"?!!m.notes?.trim():!1,V=d.useMemo(()=>Object.fromEntries(f.map(I=>[I.key,F(I.key)])),[m]);return t.jsxs("div",{className:"rsvp-page container",children:[t.jsx("h1",{children:"Rsvp"}),t.jsx(mr,{currentStep:i,steps:f,goToStep:b,stepDataMap:V}),t.jsxs("form",{className:"rsvp-form",onSubmit:I=>I.preventDefault(),children:[t.jsxs("div",{className:"form-header",children:[t.jsx("h2",{className:"step-description",children:g}),t.jsx("p",{className:"step-description",children:P})]}),t.jsx(Bt,{currentStep:i,currentStepObj:p,form:m,isClient:n,onChange:x,onGuestsChange:S,captchaToken:h,setCaptchaToken:v,recaptchaRef:Y,error:A}),A&&t.jsx("div",{className:"rsvp-error",ref:L,role:"alert",tabIndex:-1,children:A}),t.jsxs("div",{className:"form-navigation",children:[t.jsxs("button",{type:"button",onClick:_,disabled:i===0,title:r("common:back")||"Back",children:[t.jsx(E.Back,{}),r("common:previous")]}),t.jsxs("span",{children:[i+1,"/",f.length]}),i<f.length-1?t.jsx("button",{type:"button",onClick:T,disabled:j(),title:p.required||F(p.key)?r("common:next"):r("rsvp:skip"),children:p.required||F(p.key)?t.jsxs(t.Fragment,{children:[r("common:next"),t.jsx(E.Next,{})]}):t.jsxs(t.Fragment,{children:[r("rsvp:skip"),t.jsx(E.Next,{})]})}):t.jsx("button",{type:"submit",onClick:u,disabled:R||j(),children:r(R?"rsvp:sending":"rsvp:submit")})]})]})]})});export{Sr as default};
