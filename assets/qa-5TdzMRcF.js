import{a as o,w as X}from"./chunk-EPOLDU6W-BnKKP6Ue.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{I as v}from"./Icon-Dk5l_C6R.js";import{u as P}from"./useWeddingData-DmPkR6aw.js";import{m as N,A as O}from"./proxy-DBX3VoSC.js";import{M as V}from"./Map-D1ecT8pF.js";import{D as Z}from"./DonateButton-Ce93jfDg.js";import{u as ee}from"./useTranslation-B9zSoiKr.js";import{T as te}from"./Modal-DHSU4XOf.js";import"./i18next-BDvusv7y.js";const z=(c,f)=>c>60?v.Rain:c>30?v.Cloud:f<=0?v.Snow:v.Sun,ae=({test:c})=>{console.log("WeatherForecast rendered with test =",c);const f=P(),{lat:n,lng:y}=f.wedding.ceremony.venue.coordinates,m=o.useMemo(()=>new Date(f.wedding.date),[f.wedding.date]),[u,M]=o.useState([]),[t,D]=o.useState(null),[l,$]=o.useState(null),[C,S]=o.useState(!0),[r,p]=o.useState(!1),h=a=>a.toISOString().split("T")[0],s=a=>a.toLocaleDateString(void 0,{month:"short",day:"numeric"}),w=o.useMemo(()=>{if(!u.length)return"";const a=new Date(u[0].rawDate),g=new Date(u[u.length-1].rawDate),i=`${a.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}, ${a.getFullYear()}`,d=`${g.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}, ${g.getFullYear()}`;return`${i} â€“ ${d}`},[u]),L=o.useMemo(()=>{if(!t)return"";const[a,g]=t.measuredRange.split(" â€“ ");return`${a}, ${m.getFullYear()-1} â€“ ${g}, ${m.getFullYear()-1}`},[t,m]),T=o.useMemo(()=>l?`${l.date}, ${l.year}`:"",[l]);return o.useEffect(()=>{let a=!1;return(async()=>{try{const i=`https://api.open-meteo.com/v1/forecast?latitude=${n}&longitude=${y}&daily=temperature_2m_max,precipitation_probability_max&timezone=auto`,d=m.getFullYear()-1,j=m.getMonth(),_=new Date(d,j,1),q=new Date(d,j+1,0),H=`https://archive-api.open-meteo.com/v1/archive?latitude=${n}&longitude=${y}&start_date=${h(_)}&end_date=${h(q)}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=auto`,[W,R]=await Promise.all([fetch(i),fetch(H)]);if(!W.ok||!R.ok)throw new Error("Weather fetch failed");const F=await W.json(),b=await R.json();if(a)return;const J=F.daily.time.slice(0,7).map((x,k)=>({rawDate:x,date:new Date(x).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"}),temp:Math.round(F.daily.temperature_2m_max[k]),precipitation:Math.round(F.daily.precipitation_probability_max?.[k]??0)}));M(J);const Y=b.daily.temperature_2m_max,K=b.daily.temperature_2m_min,A=b.daily.precipitation_sum,U=A.length,B=A.filter(x=>x>1).length,Q=U-B;D({avgTemp:Math.round((x=>x.reduce((k,G)=>k+G,0)/x.length)(Y)),maxTemp:Math.round(Math.max(...Y)),minTemp:Math.round(Math.min(...K)),rainyDays:B,sunnyDays:Q,totalDays:U,measuredRange:`${s(_)} â€“ ${s(q)}`});const E=h(new Date(d,j,m.getDate())),I=b.daily.time.findIndex(x=>x===E);I>=0&&$({temp:Math.round(b.daily.temperature_2m_max[I]),precipitation:Math.round(b.daily.precipitation_sum[I]),date:s(new Date(E)),year:d})}catch{a||p(!0)}finally{a||S(!1)}})(),()=>{a=!0}},[n,y,m]),C?e.jsxs("div",{className:"weather-forecast loading",children:[e.jsx(v.More,{className:"loading-spinner"}),e.jsx("p",{children:"Loading weatherâ€¦"})]}):r?e.jsxs("div",{className:"weather-forecast error",children:[e.jsx(v.Cloud,{}),e.jsx("p",{children:e.jsx("strong",{children:"Weather unavailable"})}),e.jsx("small",{children:"Typical summer weather: warm & sunny â˜€ï¸"})]}):e.jsxs(N.div,{className:"weather-forecast compact",initial:{opacity:0},animate:{opacity:1},children:[u.length>0&&e.jsx("strong",{children:w}),e.jsx("div",{className:"weather-forecast__forecast",children:u.slice(0,5).map((a,g)=>{const i=z(a.precipitation,a.temp),d=new Date,j=new Date(a.rawDate),_=d.getFullYear()===j.getFullYear()&&d.getMonth()===j.getMonth()&&d.getDate()===j.getDate();return e.jsxs("div",{className:`weather-day${_?" today":""}`,children:[e.jsxs("div",{className:"date",children:[e.jsx("div",{className:"icon",children:e.jsx(i,{size:18})}),a.date," ",_&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"(today)"]})]}),e.jsxs("div",{children:[a.precipitation>30&&e.jsxs("div",{className:"rain",children:[a.precipitation,"% prec."]}),e.jsxs("div",{className:"temp",children:[a.temp,"Â°"]})]})]},g)})}),l&&e.jsxs("div",{className:"weather-forecast__wedding-day",children:[e.jsxs("strong",{children:[T,":"]}),e.jsx("div",{className:"icon",children:z(l.precipitation,l.temp)({size:18})}),e.jsxs("span",{children:[l.temp,"Â°"]}),l.precipitation>0&&e.jsxs("span",{children:[" â€¢ ðŸ’§ ",l.precipitation,"mm"]})]}),t&&e.jsxs("div",{className:"weather-forecast__typical",children:[e.jsx("small",{children:L}),e.jsxs("span",{children:["ðŸŒ§ ",t.rainyDays," rainy days â€¢ â˜€ï¸ ",t.sunnyDays," sunny days"]}),e.jsxs("span",{children:["ðŸŒ¡ ",t.avgTemp,"Â°C avg / ",t.maxTemp,"Â° / ",t.minTemp,"Â°"]})]})]})},ne=()=>{const{t:c,ready:f}=ee("qa"),n=P(),[y,m]=o.useState("essentials"),[u,M]=o.useState(null);if(!f)return e.jsx("div",{className:"loading",children:c("loading","Loading...")});const t=o.useMemo(()=>{const r=n.schedule.find(i=>i.id==="bus"),p=n.contact.find(i=>i.name.includes(n.bride.firstName)),h=n.contact.find(i=>i.name.includes(n.groom.firstName)),s=n.schedule.find(i=>i.id==="bus"),w=s?.maps[1]?.coordinates||null,L=s?.maps[1]?.extraCoordinates||[],T=s?.maps[1]?.mapUrl||"",a=s?.maps[1]?.showRoute||!1,g=s?.maps[1]?.label||"Bus Route";return{bus:{mainCoords:w,extraCoords:L.map(i=>({lat:i.lat,lng:i.lng,label:i.label||"",showMarker:!0})),mapUrl:T,showRoute:a,label:g},venueCoordinates:n.wedding.ceremony.venue.coordinates,rsvpDeadline:n.rsvp.deadline,ceremonyTime:n.wedding.ceremony.time,ceremonyVenue:n.wedding.ceremony.venue.longName,venueMapLink:n.wedding.ceremony.venue.mapLink,venueWebsite:n.wedding.ceremony.venue.website,busTime:r?.time||"13:00",weddingDate:new Date(n.wedding.date).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),brideFirstName:n.bride.firstName,bridePhone:p?.phone||"",groomFirstName:n.groom.firstName,groomPhone:h?.phone||"",airports:n.travel?.nearestAirport||[],hotels:n.travel?.hotels||[]}},[n]),D=o.useMemo(()=>c("items",{returnObjects:!0,...t})||[],[c,t]),l=o.useMemo(()=>D.filter(r=>y==="all"?!0:r.category===y),[D,y]),$=o.useCallback(r=>{M(p=>p===r?null:r)},[]),C=o.useCallback(r=>{m(r),M(null)},[]),S=["essentials","logistics","style","family","gifts","travel","all"];return e.jsxs("div",{className:"qa-page container",children:[e.jsx(N.h1,{className:"qa-title",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:c("title")}),e.jsx("div",{className:"qa-categories",children:S.map(r=>e.jsx(N.button,{className:`category-tab ${y===r?"active":""}`,onClick:()=>C(r),whileHover:{},whileTap:{},children:c(r)},r))}),e.jsx("div",{className:"qa-list",children:e.jsx(O,{mode:"popLayout",children:l.map(r=>{const p=D.findIndex(s=>s.question===r.question),h=u===p;return e.jsxs(N.div,{className:"qa-item",layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsxs("button",{className:`qa-question ${h?"open":""}`,onClick:()=>$(p),children:[e.jsx("span",{children:r.question}),e.jsx(v.Down,{className:`chevron ${h?"rotate-180":""}`})]}),e.jsx(O,{children:h&&e.jsx(N.div,{className:"qa-answer",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},children:e.jsx("div",{className:"answer-content",children:e.jsx(te,{i18nKey:`items.${p}.answer`,t:c,values:t,components:{VenueLink:e.jsx("a",{href:t.venueWebsite,target:"_blank",rel:"noopener noreferrer",style:{fontWeight:"bold",textDecoration:"none",color:"inherit"},children:t.ceremonyVenue}),MapVenue:e.jsx(V,{coordinates:t.venueCoordinates,label:t.ceremonyVenue,mapUrl:t.venueMapLink,interactive:!1,zoom:12}),MapBus:e.jsx(V,{label:t.bus.label,coordinates:t.bus.mainCoords,extraCoordinates:t.bus.extraCoords,mapUrl:t.bus.mapUrl,showRoute:t.bus.showRoute,interactive:!1,width:"100%",height:"400px"}),DonateButton:e.jsx(Z,{}),WeatherForecast:e.jsx(ae,{}),SkyscannerLink:e.jsx("a",{href:"https://www.skyscanner.com/",target:"_blank",rel:"noopener noreferrer",children:c("links.skyscanner","Skyscanner")}),AirBnbLink:e.jsx("a",{href:"https://www.airbnb.com/",target:"_blank",rel:"noopener noreferrer",children:c("links.airbnb","AirBnB")}),AirportsList:e.jsx("ul",{children:t.airports.map((s,w)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[s.name," (",s.code,")"]})," ","â€“ ",c("distance",{distance:s.distance}),","," ",c("transport",{transport:s.transportOptions.join(", ")})]},w))}),HotelLinks:e.jsx("ul",{children:t.hotels.map((s,w)=>e.jsx("li",{children:e.jsxs("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",children:[s.name," â€“ ",s.address]})},w))}),strong:e.jsx("strong",{}),p:e.jsx("p",{}),br:e.jsx("br",{})}})})})})]},r.question)})})})]})},ge=X(ne);export{ge as default};
