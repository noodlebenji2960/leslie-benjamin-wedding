import{j as w}from"./jsx-runtime-u17CrQMm.js";import{a as e}from"./chunk-EPOLDU6W-C9vtjoJn.js";const v="wedding_visitor_id",d="wedding_last_visit",m="wedding_visit_count",h="wedding_cookie_pref",C=3e4,E=e.createContext(null),k=({children:t})=>{const u=e.useRef(Date.now()),o=e.useRef(null),[s,a]=e.useState(null),[l,c]=e.useState(null),r=n=>{typeof window<"u"&&localStorage.setItem(h,JSON.stringify(n)),c(n),console.debug("[Session] Cookie preference updated:",n)};return e.useEffect(()=>{if(typeof window>"u")return;const n=localStorage.getItem(h);n&&c(JSON.parse(n));const S=navigator.userAgent,f=/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(S)?"tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(S)?"mobile":"desktop",g=localStorage.getItem(v),T=localStorage.getItem(d),_=parseInt(localStorage.getItem(m)||"0");if(g){const i=parseInt(T||"0"),b=Math.floor((Date.now()-i)/(1e3*60*60*24)),I=_+1;localStorage.setItem(d,Date.now().toString()),localStorage.setItem(m,I.toString()),a({visitorId:g,isFirstVisit:!1,isReturningVisitor:!0,daysSinceLastVisit:b,visitCount:I,deviceType:f,timeOnSite:0,lastVisitTime:i})}else{const i=`visitor_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;localStorage.setItem(v,i),localStorage.setItem(d,Date.now().toString()),localStorage.setItem(m,"1"),a({visitorId:i,isFirstVisit:!0,isReturningVisitor:!1,daysSinceLastVisit:0,visitCount:1,deviceType:f,timeOnSite:0,lastVisitTime:null})}return o.current=setInterval(()=>{a(i=>i?{...i,timeOnSite:Math.floor((Date.now()-u.current)/1e3)}:null)},C),()=>{o.current&&clearInterval(o.current)}},[]),w.jsx(E.Provider,{value:{visitor:s,cookiePreference:l,setCookiePreference:r},children:t})},V=()=>{const t=e.useContext(E);if(!t)throw new Error("useSession must be used within a SessionProvider");return t},p=e.createContext(void 0);function y({children:t}){const{cookiePreference:u}=V(),o=u?.personalization??!1,[s,a]=e.useState("system"),[l,c]=e.useState(!1);return e.useEffect(()=>{if(o&&!l){const r=localStorage.getItem("theme");r&&a(r),c(!0)}o||c(!1)},[o,l]),e.useEffect(()=>{s==="system"?document.documentElement.removeAttribute("data-theme"):document.documentElement.setAttribute("data-theme",s),o&&localStorage.setItem("theme",s)},[s,o]),e.useEffect(()=>{const r=window.matchMedia("(prefers-color-scheme: dark)"),n=()=>{s==="system"&&document.documentElement.removeAttribute("data-theme")};return r.addEventListener("change",n),()=>r.removeEventListener("change",n)},[s]),w.jsx(p.Provider,{value:{theme:s,setTheme:a},children:t})}const O=()=>{const t=e.useContext(p);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t};export{k as S,y as T,E as a,O as b,V as u};
