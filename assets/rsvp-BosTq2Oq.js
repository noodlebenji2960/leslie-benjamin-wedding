import{a as u,w as K}from"./chunk-LFPYN7LY-BSAdruXa.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{u as A}from"./useTranslation-DhuK-hdO.js";import{I as x}from"./Icon-DOFxzM3z.js";import{m as y,A as H,M as J,T as X}from"./Modal-CNge4sqE.js";import{M as Z,R as Q,u as ee}from"./useRSVPSubmit-DGwgdeKi.js";import{u as te}from"./LanguageContext-BYdMKH5j.js";import{u as U}from"./AnalyticsContext-Dv958otn.js";import{u as ae}from"./lenis-react-Boms-NFb.js";import{u as se}from"./useWeddingData-FVPQl0sS.js";import"./i18next-CMP4XeMd.js";import"./LayoutContext-p-UZ0jeN.js";const ne=/^[\w\-.]+@([\w-]+\.)+[\w-]{2,4}$/,re=/[^\w\-+.@]/,ie=/[^\w\-+.@]/g,le=({form:t,onChange:a})=>{const{t:s}=A(["rsvp"]),[l,d]=u.useState(!1);u.useRef(null);const m=l?(r=>r.trim()?ne.test(r)?null:s("rsvp:errors.invalidEmail"):s("rsvp:errors.required"))(t.email):null,j=l&&!m&&t.email.trim()!=="",i=r=>{r.key.length===1&&re.test(r.key)&&r.preventDefault()},n=r=>{r.target.value=r.target.value.replace(ie,"").toLowerCase(),a(r)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"email",children:[s("rsvp:email")," ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:"email",name:"email",type:"email",value:t.email,onKeyDown:i,onChange:n,onBlur:()=>d(!0),className:`form-input ${m?"form-input-invalid":j?"form-input-valid":""}`,required:!0,autoComplete:"email",tabIndex:0}),m&&e.jsx("div",{className:"field-error",children:m})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"attending",children:[s("rsvp:attending")," ",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"attending",name:"attending",value:t.attending,onChange:a,className:`form-input ${t.attending?"form-input-valid":""}`,required:!0,autoComplete:"off",tabIndex:0,children:[e.jsx("option",{value:"",children:s("rsvp:select")}),e.jsx("option",{value:"yes",children:s("rsvp:yes")}),e.jsx("option",{value:"no",children:s("rsvp:no")})]})]})]})},Y=({index:t,guest:a,onUpdate:s,onRemove:l,onConfirm:d,onEditToggle:p,isDraft:m=!1,isRostered:j=!1,isEditing:i=!1})=>{const{t:n}=A(["rsvp"]),[r,o]=u.useState(!1),[f,c]=u.useState(!1),[h,g]=u.useState(!1),[k,C]=u.useState(!1),T=u.useRef(null),N=a.firstName.trim()&&a.lastName.trim(),_=m||i,I=a.firstName||a.lastName?`${a.firstName} ${a.lastName}`.trim():n("rsvp:newGuest"),$=v=>v.replace(/[^a-zA-ZÀ-ÿ\s'-]/g,""),w=(v,R)=>v.slice(0,R),P=v=>v.charAt(0).toUpperCase()+v.slice(1),O=(v,R)=>{const L=w($(P(R)),30);s?.(t,v,L)},S=(v,R,L)=>{const D=L?w(R,L):R;s?.(t,v,D)},E=()=>{if(!N){g(!0);return}d&&d(),g(!1),o(!1),c(!1),setTimeout(()=>T.current?.focus(),0)},V=()=>{p?.(i?null:t)},q=v=>{m&&v.key==="Enter"&&!(v.target instanceof HTMLTextAreaElement)&&(v.preventDefault(),E())};return u.useEffect(()=>{a.dietary&&o(!0),a.note&&c(!0)},[a.dietary,a.note]),u.useEffect(()=>{!i&&j&&(a.dietary||o(!1),a.note||c(!1))},[i,j,a.dietary,a.note]),u.useEffect(()=>{i&&setTimeout(()=>T.current?.focus(),0)},[i]),e.jsxs(e.Fragment,{children:[e.jsxs(y.div,{className:`guest-card ${h&&!N?"invalid":""} ${j&&!i?"guest-card--locked guest-card--viewing":""} ${i?"guest-card--editing":""}`,role:"group","aria-label":I,onKeyDown:q,layout:"position",initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",stiffness:400,damping:30,layout:{type:"spring",stiffness:500}},children:[j&&!i?e.jsxs("div",{className:"inputs-container",children:[e.jsxs("p",{className:"guest-name",children:[a.firstName," ",a.lastName]}),a.dietary&&e.jsxs("p",{className:"guest-meta",children:[e.jsx(x.Food,{"aria-hidden":"true"}),a.dietary]}),a.note&&e.jsxs("p",{className:"guest-meta",children:[e.jsx(x.Note,{"aria-hidden":"true"}),a.note]})]}):e.jsxs("div",{className:"inputs-container",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("input",{ref:T,type:"text",name:"firstName",placeholder:n("rsvp:firstName"),"aria-label":n("rsvp:firstName"),"aria-required":"true","aria-invalid":h&&!a.firstName.trim()?"true":void 0,value:a.firstName,onChange:v=>O("firstName",v.target.value),maxLength:30}),e.jsx("input",{type:"text",name:"lastName",placeholder:n("rsvp:lastName"),"aria-label":n("rsvp:lastName"),"aria-required":"true","aria-invalid":h&&!a.lastName.trim()?"true":void 0,value:a.lastName,onChange:v=>O("lastName",v.target.value),maxLength:30})]}),e.jsxs(H,{children:[r&&e.jsxs(y.div,{className:"form-row",initial:{opacity:0,scaleY:.8,originY:0},animate:{opacity:1,scaleY:1,transition:{type:"spring",stiffness:400,damping:30}},exit:{opacity:0,scaleY:.8,transition:{duration:.15}},children:[e.jsx("input",{type:"text",placeholder:n("rsvp:dietaryPlaceholder"),"aria-label":n("rsvp:dietaryPlaceholder"),value:a.dietary,onChange:v=>S("dietary",v.target.value,100),maxLength:100}),e.jsx("button",{type:"button",className:"close-btn","aria-label":n("rsvp:removeDietary"),onClick:()=>{o(!1),S("dietary","")},children:"×"})]}),f&&e.jsxs(y.div,{className:"form-row",initial:{opacity:0,scaleY:.8,originY:0},animate:{opacity:1,scaleY:1,transition:{type:"spring",stiffness:400,damping:30}},exit:{opacity:0,scaleY:.8,transition:{duration:.15}},children:[e.jsx("textarea",{placeholder:n("rsvp:notePlaceholder"),"aria-label":n("rsvp:notePlaceholder"),value:a.note||"",onChange:v=>S("note",v.target.value,200),maxLength:200}),e.jsx("button",{type:"button",className:"close-btn","aria-label":n("rsvp:removeNote"),onClick:()=>{c(!1),S("note","")},children:"×"})]})]})]}),e.jsxs("div",{className:"guest-card-actions",role:"toolbar","aria-label":n("rsvp:guestActions",{name:I}),children:[_&&!r&&e.jsx("button",{type:"button",className:"three-dots-btn",onClick:()=>o(!0),title:n("rsvp:addDietary"),"aria-label":n("rsvp:addDietary"),children:e.jsx(x.Food,{"aria-hidden":"true"})}),_&&!f&&e.jsx("button",{type:"button",className:"three-dots-btn",onClick:()=>c(!0),title:n("rsvp:addNote"),"aria-label":n("rsvp:addNote"),children:e.jsx(x.Note,{"aria-hidden":"true"})}),m?e.jsx(y.button,{type:"button",className:"form-btn add-guest-btn",onClick:E,whileHover:{scale:1.02},title:n("rsvp:addGuest"),"aria-label":n("rsvp:addGuest"),children:e.jsx(x.Add,{"aria-hidden":"true"})}):e.jsxs(e.Fragment,{children:[i&&e.jsx("button",{type:"button",className:"remove-guest",onClick:()=>C(!0),"aria-label":n("rsvp:removeGuestConfirm",{name:`${a.firstName} ${a.lastName}`}),children:e.jsx(x.Delete,{"aria-hidden":"true"})}),e.jsx("button",{type:"button",className:`three-dots-btn ${i?"confirm-guest-edit":""}`,onClick:V,"aria-label":n(i?"rsvp:doneEditing":"rsvp:editGuest"),"aria-pressed":i,title:n(i?"rsvp:doneEditing":"rsvp:editGuest"),children:i?e.jsx(x.Check,{"aria-hidden":"true"}):e.jsx(x.Edit,{"aria-hidden":"true"})})]})]})]}),e.jsx(J,{isOpen:k,onClose:()=>C(!1),closeOnBackdropClick:!0,showCloseButton:!1,"aria-labelledby":"confirm-modal-title",children:e.jsxs("div",{className:"confirm-modal",role:"alertdialog","aria-modal":"true","aria-labelledby":"confirm-modal-title",children:[e.jsx("p",{id:"confirm-modal-title",children:n("rsvp:removeGuestConfirm",{name:`${a.firstName} ${a.lastName}`})}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{type:"button",className:"button",onClick:()=>C(!1),children:n("rsvp:cancel")}),e.jsx("button",{type:"button",className:"button button--danger",onClick:()=>{l?.(t),C(!1)},children:n("rsvp:remove")})]})]})})]})},z={firstName:"",lastName:"",dietary:"",note:""},oe=({guests:t,onGuestsChange:a})=>{const{t:s}=A(["rsvp"]),[l,d]=u.useState(z),[p,m]=u.useState(null),j=u.useCallback(c=>{a(t.filter((h,g)=>g!==c)),m(null)},[t,a]),i=u.useCallback((c,h,g)=>t.some((k,C)=>C!==g&&k.firstName.trim().toLowerCase()===c.trim().toLowerCase()&&k.lastName.trim().toLowerCase()===h.trim().toLowerCase()),[t]),n=u.useCallback(()=>{!l.firstName.trim()||!l.lastName.trim()||i(l.firstName,l.lastName)||(a([...t,l]),d(z))},[l,t,i,a]),r=u.useCallback((c,h,g)=>{const k={...t[c],[h]:g};(h==="firstName"||h==="lastName")&&i(k.firstName,k.lastName,c)||a(t.map((C,T)=>T===c?k:C))},[t,i,a]),o=u.useCallback((c,h)=>{d(g=>({...g,[c]:h}))},[]),f=u.useCallback(c=>{m(c)},[]);return e.jsxs("div",{className:"guests-section","aria-label":s("rsvp:guestsTitle.plural"),children:[e.jsxs("div",{className:"add-guest-section",children:[e.jsx(y.label,{className:"add-another-label",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},children:t.length===0?s("rsvp:addGuest"):s("rsvp:addAnother")}),e.jsx(Y,{index:t.length,guest:l,onUpdate:(c,h,g)=>o(h,g),onConfirm:n,isDraft:!0},"draft")]}),e.jsxs(H,{children:[t.length>0&&e.jsxs("div",{className:"guests-count",children:[t.length," ",s(t.length===1?"rsvp:guestsTitle.singular":"rsvp:guestsTitle.plural")]}),t.map((c,h)=>e.jsx(Y,{index:h,guest:c,onUpdate:r,onRemove:j,onEditToggle:f,isEditing:p===h,isRostered:!0},`roster-${h}`))]})]})},ce=({attending:t,guests:a,nonAttendingName:s,onChange:l,onGuestsChange:d})=>{const{t:p}=A(["rsvp"]);return t==="yes"?e.jsx(oe,{guests:a,onGuestsChange:d,required:!0}):e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"nonAttendingName",children:[p("rsvp:yourName")," ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{id:"nonAttendingName",name:"nonAttendingName",type:"text",value:s,onChange:l,className:"form-input",required:!0,autoComplete:"name",spellCheck:!1,tabIndex:0})]})},de=({musicRequest:t,onChange:a})=>e.jsx(Z,{musicRequests:t,onChange:s=>a({target:{name:"musicRequest",value:s}})}),me=({attending:t,notes:a,onChange:s})=>e.jsx("div",{className:"form-group",children:e.jsx("textarea",{id:"notes",name:"notes",value:a,onChange:s,className:"form-input",tabIndex:0})}),ue=({form:t})=>{const{t:a}=A(["rsvp"]);return e.jsx("div",{className:"review-card",children:e.jsxs("div",{className:"review-card__inner",children:[e.jsxs("div",{className:"review-card__field",children:[e.jsx("span",{className:"review-card__field-label",children:a("rsvp:email")}),e.jsx("span",{className:"review-card__field-value",children:t.email})]}),t.attending==="yes"&&t.guests.length>0&&e.jsxs("div",{className:"review-card__field",children:[e.jsxs("span",{className:"review-card__field-label",children:[a("rsvp:review.numberAttending")," (",t.guests.length,")"]}),e.jsx("ul",{className:"review-card__guests",children:t.guests.map((s,l)=>e.jsxs("li",{className:"review-card__field-value",children:[s.firstName," ",s.lastName,s.dietary&&e.jsxs("span",{className:"review-card__dietary",children:[" ","(",s.dietary,")"]})]},l))})]}),t.attending==="no"&&e.jsxs("div",{className:"review-card__field",children:[e.jsx("span",{className:"review-card__field-label",children:a("rsvp:name")}),e.jsx("span",{className:"review-card__field-value",children:t.nonAttendingName})]}),t.notes&&e.jsxs("div",{className:"review-card__field",children:[e.jsx("span",{className:"review-card__field-label",children:a("rsvp:messageToBrideGroom")}),e.jsxs("p",{className:"review-card__note review-card__field-value",children:['"',t.notes,'"']})]}),t.attending==="yes"&&t.musicRequest&&t.musicRequest.length>0&&e.jsxs("div",{className:"review-card__field",children:[e.jsx("span",{className:"review-card__field-label",children:a("rsvp:musicRequest")}),e.jsx("ul",{className:"review-card__songs",children:t.musicRequest.map((s,l)=>e.jsxs("li",{className:"review-card__song",children:[e.jsx("img",{src:s.artworkUrl100,alt:s.trackName,className:"review-card__song-art"}),e.jsxs("span",{className:"review-card__field-value",children:[s.trackName," — ",s.artistName]})]},l))})]})]})})},pe=({form:t,onChange:a,captchaToken:s,error:l,recaptchaRef:d,setCaptchaToken:p,isDev:m})=>{const{locale:j}=te(),{t:i}=A(["rsvp"]);return e.jsxs(e.Fragment,{children:[e.jsx(ue,{form:t}),e.jsx("div",{className:"form-group form-group--consent",children:e.jsxs("label",{className:"consent-label",children:[e.jsx("input",{type:"checkbox",name:"termsAccepted",checked:!!t.termsAccepted,onChange:a,className:"consent-checkbox",tabIndex:0}),e.jsxs("span",{className:"consent-text",children:[i("rsvp:terms.iAgree")," ",e.jsx("a",{href:`/${j}/legal/terms`,target:"_blank",rel:"noopener noreferrer",children:i("rsvp:terms.termsLinkText")})," ",i("rsvp:terms.and")," ",e.jsx("a",{href:`/${j}/legal/privacy`,target:"_blank",rel:"noopener noreferrer",children:i("rsvp:terms.privacyLinkText")}),"."]})]})}),!m&&e.jsx(Q,{sitekey:"6Lcy_mcsAAAAADoT-ibwy1RvePEHG4xJ87D0fdse",onChange:n=>p(n),ref:d,style:{display:"inline-block",width:"100%",marginTop:"1rem"}}),!m&&!s&&l&&e.jsx("div",{className:"field-error",children:i("rsvp:errors.captchaRequired")})]})},ve=!1,G={initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},fe=t=>{const{currentStep:a,form:s,isClient:l,currentStepObj:d}=t;return e.jsx(e.Fragment,{children:e.jsxs(H,{mode:"wait",children:[a===0&&e.jsx(y.div,{variants:G,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:e.jsx(le,{...t})},"step0"),d.key==="guestsOrName"&&e.jsx(y.div,{variants:G,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:e.jsx(ce,{attending:s.attending,guests:s.guests,nonAttendingName:s.nonAttendingName??"",onChange:t.onChange,onGuestsChange:t.onGuestsChange})},"guestsOrName"),d.key==="musicRequest"&&s.attending==="yes"&&e.jsx(y.div,{variants:G,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:e.jsx(de,{musicRequest:s.musicRequest||[],onChange:t.onChange})},"musicRequest"),d.key==="notes"&&e.jsx(y.div,{variants:G,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:e.jsx(me,{attending:s.attending,notes:s.notes,onChange:t.onChange})},"notes"),d.key==="review"&&l&&e.jsx(y.div,{variants:G,initial:"initial",animate:"animate",exit:"exit",className:"form-content",tabIndex:-1,children:e.jsx(pe,{form:s,onChange:t.onChange,captchaToken:t.captchaToken,error:t.error,recaptchaRef:t.recaptchaRef,setCaptchaToken:t.setCaptchaToken,isDev:ve})},"review")]})})},he=({submittedRef:t,guestEmail:a})=>{const{t:s}=A(["home","common","rsvp"]),[l,d]=u.useState(!1);return u.useEffect(()=>{const p=setTimeout(()=>d(!0),50),m=setInterval(()=>{d(!1),setTimeout(()=>d(!0),55)},1e4);return()=>{clearTimeout(p),clearInterval(m)}},[]),e.jsxs(y.div,{className:"rsvp-page container",ref:t,tabIndex:-1,role:"status","aria-live":"polite",initial:{opacity:0,scale:.9,y:30},animate:{opacity:1,scale:1,y:0,transition:{type:"spring",stiffness:300,damping:25,duration:.6}},children:[e.jsx(y.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:400,damping:20,delay:1},className:"heart-animated","aria-hidden":"true",style:{fontSize:"4rem",marginBottom:"1.5rem",display:"flex",justifyContent:"center"},children:e.jsxs("svg",{viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",children:[e.jsx("defs",{children:e.jsx("path",{id:"heart",d:"M12 4.435c-1.989-5.399-12-4.597-12 3.568 0 4.068 3.06 9.481 12 14.997 8.94-5.516 12-10.929 12-14.997 0-8.118-10-8.999-12-3.568z"})}),e.jsx(y.use,{xlinkHref:"#heart",initial:{opacity:0,scale:.33},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:15},style:{transformOrigin:"center"}},l?"on":"off")]})}),e.jsx(y.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},style:{textAlign:"center",marginBottom:"1rem"},children:s("rsvp:thankYou")}),e.jsx(y.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},style:{textAlign:"center",maxWidth:"500px",margin:"0 auto 2rem",lineHeight:1.6},children:s("rsvp:confirmation",{guestEmail:a})})]})};function xe(t){const a=U(),[s,l]=u.useState({...t,musicRequest:t.musicRequest||"",termsAccepted:!1}),[d,p]=u.useState(0),[m,j]=u.useState(null),[i,n]=u.useState(!1),r=ae(()=>{}),{t:o}=A(["rsvp"]),f=[{key:"contactAndAttendance",required:!0,icon:e.jsx(x.Contact,{}),stepName:o("rsvp:steps.contactAndAttendance.stepTitle")},{key:"guestsOrName",required:!0,icon:e.jsx(x.People,{}),completionIcon:e.jsx("p",{children:s.guests.length}),stepName:o("rsvp:steps.guestsOrName.stepTitle")},{key:"musicRequest",required:!1,icon:e.jsx(x.Music.default,{}),completionIcon:e.jsx("p",{children:s.musicRequest?.length}),stepName:o("rsvp:steps.musicRequest.stepTitle")},{key:"notes",required:!1,icon:e.jsx(x.LoveLetter,{}),completionIcon:e.jsx(x.Heart.default,{}),stepName:o("rsvp:steps.notes.stepTitle")},{key:"review",required:!0,icon:e.jsx(x.Checklist,{}),completionIcon:e.jsx(x.Tick,{}),stepName:o("rsvp:steps.review.stepTitle")}];(s.attending==="no"||s.attending===void 0)&&f.splice(2,1);const c=f[d];return{form:s,setForm:l,currentStep:d,currentStepObj:c,steps:f,error:m,setError:j,hasValidGuests:i,handleChange:N=>{const{name:_}=N.target,I=N.target instanceof HTMLInputElement&&N.target.type==="checkbox"?N.target.checked:N.target.value;l($=>({...$,[_]:I})),j(null)},handleGuestsChange:N=>{l(_=>({..._,guests:N})),n(N.some(_=>_.firstName.trim()&&_.lastName.trim()))},nextStep:()=>{a.event("rsvp_step_complete",{event_label:c.key,step_number:d+1,step_name:c.key}),p(N=>N+1),r?.scrollTo(0)},prevStep:()=>{a.event("rsvp_step_back",{event_label:c.key,step_number:d+1,step_name:c.key}),p(N=>N-1),r?.scrollTo(0)},goToStep:N=>{p(N),r?.scrollTo(0)}}}function Ne(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&!("$$typeof"in t)&&("component"in t||"icon"in t||"key"in t)}function je(t){return typeof t=="number"?Array.from({length:t},()=>({node:null,meta:null})):t.map(a=>Ne(a)?{node:a.component??a.icon??null,meta:a}:{node:a,meta:null})}const ye=({currentStep:t,steps:a,goToStep:s,stepDataMap:l})=>{const d=je(a),p=d.length,m=Math.max(0,Math.min(t,p-1)),j=p>1?m/(p-1)*100:100;return e.jsx("div",{className:"progress-bar-container",role:"progressbar","aria-valuenow":m,"aria-valuemin":0,"aria-valuemax":p-1,"aria-label":d[m]?.meta?.stepName?`Step ${m+1}: ${d[m].meta.stepName}`:d[m]?.meta?.key?`Step ${m+1}: ${d[m].meta.key}`:`Step ${m+1} of ${p}`,children:e.jsxs("div",{className:"progress-bar",children:[e.jsx(y.div,{className:"progress-bar__fill",animate:{width:`${j}%`},transition:{duration:.7,ease:"easeInOut"}}),e.jsx("div",{className:"progress-bar__steps",children:d.map(({node:i,meta:n},r)=>{const o=r<m,f=r===m,c=n?.key?l?.[n.key]??!1:!1;return e.jsxs(y.div,{className:"progress-step",title:n?.stepName??n?.key,onClick:()=>{o&&s(r)},style:{position:"absolute",left:`${p>1?r/(p-1)*100:50}%`,cursor:o?"pointer":"default"},transformTemplate:({scale:h})=>`translate(-50%, -50%) scale(${h??1})`,animate:{backgroundColor:o?"var(--color-primary)":"var(--color-white)",color:o?"var(--color-white)":"var(--color-border)",borderColor:f||o?"var(--color-primary)":"var(--color-border)",borderStyle:"solid"},transition:{duration:.25,ease:"easeInOut"},children:[i,e.jsx("div",{className:`progress-step-status-icon ${o?"":"hidden"}`,children:n.completionIcon&&c?n.completionIcon:c?e.jsx(x.Tick,{}):e.jsx(x.Close,{})})]},r)})})]})})};let B=!1,M=!1;const $e=K(function(){const{t:a,ready:s}=A(["home","common","rsvp"]),l=U(),[d,p]=u.useState(!1),[m,j]=u.useState(null),i=u.useRef(null),n=se(),{form:r,currentStep:o,currentStepObj:f,steps:c,error:h,handleChange:g,handleGuestsChange:k,nextStep:C,prevStep:T,goToStep:N,hasValidGuests:_}=xe({email:"",attending:"",guests:[],nonAttendingName:"",notes:"",website:""}),{submit:I,sending:$,submitted:w,error:P,setSubmitted:O}=ee(r,m,o),S=u.useRef(null),E=u.useRef(null),V=u.useRef(null),q=h||P;if(u.useEffect(()=>{B||(l.event("rsvp_start",{event_label:"User started RSVP form"}),B=!0),M=!1;const b=()=>{!w&&!M&&(l.event("rsvp_abandonment",{event_label:`Abandoned at ${f.key}`,step_number:o+1,step_name:f.key}),M=!0)};return window.addEventListener("beforeunload",b),()=>{window.removeEventListener("beforeunload",b),i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{!window.location.pathname.includes("/rsvp")&&(!w&&!M&&(l.event("rsvp_abandonment",{event_label:`Abandoned at ${f.key}`,step_number:o+1,step_name:f.key}),M=!0),B=!1),i.current=null},100)}},[o,f,c,w,l]),u.useEffect(()=>p(!0),[]),u.useEffect(()=>{q&&S.current&&(S.current.scrollIntoView({behavior:"smooth",block:"center"}),S.current.focus()),w&&E.current&&E.current.focus()},[q,w]),!s)return e.jsx("div",{className:"loading",children:a("common:loading")});if(w)return e.jsx(he,{onReset:()=>O(!1),submittedRef:E,guestEmail:r.email});const v=()=>o===0?!r.attending||!r.email:o===1?r.attending==="yes"?!_:!r.nonAttendingName:o===2||o===3?!1:o===4?!m||!r.termsAccepted:!1,R=a(`rsvp:steps.${f.key}.stepTitle`),L=e.jsx(X,{i18nKey:`rsvp:steps.${f.key}.stepText`,values:{bride:n.bride.firstName,groom:n.groom.firstName}}),D=b=>b==="contactAndAttendance"?!!r.email||!!r.attending:b==="guestsOrName"?r.attending==="yes"?Array.isArray(r.guests)&&r.guests.some(F=>F.firstName.trim()&&F.lastName.trim()):!!r.nonAttendingName?.trim():b==="musicRequest"?Array.isArray(r.musicRequest)&&r.musicRequest.length>0:b==="notes"?!!r.notes?.trim():!1,W=u.useMemo(()=>Object.fromEntries(c.map(b=>[b.key,D(b.key)])),[r]);return e.jsxs("div",{className:"rsvp-page container",children:[e.jsx("h1",{children:"Rsvp"}),e.jsx(ye,{currentStep:o,steps:c,goToStep:N,stepDataMap:W}),e.jsxs("form",{className:"rsvp-form",onSubmit:b=>b.preventDefault(),children:[e.jsxs("div",{className:"form-header",children:[e.jsx("h2",{className:"step-description",children:R}),e.jsx("p",{className:"step-description",children:L})]}),e.jsx(fe,{currentStep:o,currentStepObj:f,form:r,isClient:d,onChange:g,onGuestsChange:k,captchaToken:m,setCaptchaToken:j,recaptchaRef:V,error:q}),q&&e.jsx("div",{className:"rsvp-error",ref:S,role:"alert",tabIndex:-1,children:q}),e.jsxs("div",{className:"form-navigation",children:[e.jsxs("button",{type:"button",onClick:T,disabled:o===0,title:a("common:back")||"Back",children:[e.jsx(x.Back,{}),a("common:previous")]}),e.jsxs("span",{children:[o+1,"/",c.length]}),o<c.length-1?e.jsx("button",{type:"button",onClick:C,disabled:v(),title:f.required||D(f.key)?a("common:next"):a("rsvp:skip"),children:f.required||D(f.key)?e.jsxs(e.Fragment,{children:[a("common:next"),e.jsx(x.Next,{})]}):e.jsxs(e.Fragment,{children:[a("rsvp:skip"),e.jsx(x.Next,{})]})}):e.jsx("button",{type:"submit",onClick:I,disabled:$||v(),children:a($?"rsvp:sending":"rsvp:submit")})]})]})]})});export{$e as default};
