import{a as o,w as X,t as Z}from"./chunk-LFPYN7LY-BSAdruXa.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{I as y}from"./Icon-DOFxzM3z.js";import{u as z}from"./useWeddingData-FVPQl0sS.js";import{m as k,A as P,T as ee}from"./Modal-CNge4sqE.js";import{M as E}from"./Map-CXJNRygg.js";import{D as te}from"./DonateButton-Dli3LDj9.js";import{u as ae}from"./ConfigContext-BK9_EVan.js";import"./useRSVPSubmit-DGwgdeKi.js";import"./LanguageContext-BYdMKH5j.js";import"./AnalyticsContext-Dv958otn.js";import{u as ne}from"./useBuildLink-C2T3xW8X.js";import{u as se}from"./useTranslation-DhuK-hdO.js";import"./i18next-CMP4XeMd.js";import"./lenis-react-Boms-NFb.js";import"./LayoutContext-p-UZ0jeN.js";const O=(p,i)=>p>60?y.Rain:p>30?y.Cloud:i<=0?y.Snow:y.Sun,re=({test:p})=>{console.log("WeatherForecast rendered with test =",p);const i=z(),{lat:j,lng:s}=i.wedding.ceremony.venue.coordinates,c=o.useMemo(()=>new Date(i.wedding.date),[i.wedding.date]),[h,T]=o.useState([]),[d,S]=o.useState(null),[n,v]=o.useState(null),[M,$]=o.useState(!0),[C,L]=o.useState(!1),D=t=>t.toISOString().split("T")[0],r=t=>t.toLocaleDateString(void 0,{month:"short",day:"numeric"}),g=o.useMemo(()=>{if(!h.length)return"";const t=new Date(h[0].rawDate),l=new Date(h[h.length-1].rawDate),x=`${t.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}, ${t.getFullYear()}`,m=`${l.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}, ${l.getFullYear()}`;return`${x} â€“ ${m}`},[h]),w=o.useMemo(()=>{if(!d)return"";const[t,l]=d.measuredRange.split(" â€“ ");return`${t}, ${c.getFullYear()-1} â€“ ${l}, ${c.getFullYear()-1}`},[d,c]),u=o.useMemo(()=>n?`${n.date}, ${n.year}`:"",[n]);return o.useEffect(()=>{let t=!1;return(async()=>{try{const x=`https://api.open-meteo.com/v1/forecast?latitude=${j}&longitude=${s}&daily=temperature_2m_max,precipitation_probability_max&timezone=auto`,m=c.getFullYear()-1,a=c.getMonth(),_=new Date(m,a,1),q=new Date(m,a+1,0),J=`https://archive-api.open-meteo.com/v1/archive?latitude=${j}&longitude=${s}&start_date=${D(_)}&end_date=${D(q)}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=auto`,[I,R]=await Promise.all([fetch(x),fetch(J)]);if(!I.ok||!R.ok)throw new Error("Weather fetch failed");const V=await I.json(),b=await R.json();if(t)return;const Q=V.daily.time.slice(0,7).map((f,N)=>({rawDate:f,date:new Date(f).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"}),temp:Math.round(V.daily.temperature_2m_max[N]),precipitation:Math.round(V.daily.precipitation_probability_max?.[N]??0)}));T(Q);const W=b.daily.temperature_2m_max,H=b.daily.temperature_2m_min,Y=b.daily.precipitation_sum,U=Y.length,A=Y.filter(f=>f>1).length,K=U-A;S({avgTemp:Math.round((f=>f.reduce((N,G)=>N+G,0)/f.length)(W)),maxTemp:Math.round(Math.max(...W)),minTemp:Math.round(Math.min(...H)),rainyDays:A,sunnyDays:K,totalDays:U,measuredRange:`${r(_)} â€“ ${r(q)}`});const B=D(new Date(m,a,c.getDate())),F=b.daily.time.findIndex(f=>f===B);F>=0&&v({temp:Math.round(b.daily.temperature_2m_max[F]),precipitation:Math.round(b.daily.precipitation_sum[F]),date:r(new Date(B)),year:m})}catch{t||L(!0)}finally{t||$(!1)}})(),()=>{t=!0}},[j,s,c]),M?e.jsxs("div",{className:"weather-forecast loading",children:[e.jsx(y.More,{className:"loading-spinner"}),e.jsx("p",{children:"Loading weatherâ€¦"})]}):C?e.jsxs("div",{className:"weather-forecast error",children:[e.jsx(y.Cloud,{}),e.jsx("p",{children:e.jsx("strong",{children:"Weather unavailable"})}),e.jsx("small",{children:"Typical summer weather: warm & sunny â˜€ï¸"})]}):e.jsxs(k.div,{className:"weather-forecast compact",initial:{opacity:0},animate:{opacity:1},children:[h.length>0&&e.jsx("strong",{children:g}),e.jsx("div",{className:"weather-forecast__forecast",children:h.slice(0,5).map((t,l)=>{const x=O(t.precipitation,t.temp),m=new Date,a=new Date(t.rawDate),_=m.getFullYear()===a.getFullYear()&&m.getMonth()===a.getMonth()&&m.getDate()===a.getDate();return e.jsxs("div",{className:`weather-day${_?" today":""}`,children:[e.jsxs("div",{className:"date",children:[e.jsx("div",{className:"icon",children:e.jsx(x,{size:18})}),t.date," ",_&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"(today)"]})]}),e.jsxs("div",{children:[t.precipitation>30&&e.jsxs("div",{className:"rain",children:[t.precipitation,"% prec."]}),e.jsxs("div",{className:"temp",children:[t.temp,"Â°"]})]})]},l)})}),n&&e.jsxs("div",{className:"weather-forecast__wedding-day",children:[e.jsxs("strong",{children:[u,":"]}),e.jsx("div",{className:"icon",children:O(n.precipitation,n.temp)({size:18})}),e.jsxs("span",{children:[n.temp,"Â°"]}),n.precipitation>0&&e.jsxs("span",{children:[" â€¢ ðŸ’§ ",n.precipitation,"mm"]})]}),d&&e.jsxs("div",{className:"weather-forecast__typical",children:[e.jsx("small",{children:w}),e.jsxs("span",{children:["ðŸŒ§ ",d.rainyDays," rainy days â€¢ â˜€ï¸ ",d.sunnyDays," sunny days"]}),e.jsxs("span",{children:["ðŸŒ¡ ",d.avgTemp,"Â°C avg / ",d.maxTemp,"Â° / ",d.minTemp,"Â°"]})]})]})},oe=()=>{const p=ae(),{t:i,ready:j}=se("qa"),s=z(),[c,h]=o.useState("essentials"),[T,d]=o.useState(null),{buildLink:S}=ne();if(!j)return e.jsx("div",{className:"loading",children:i("loading","Loading...")});const n=o.useMemo(()=>{const r=s.schedule.find(a=>a.id==="bus-to-venue"||a.type==="bus-to-venue"),g=s.schedule.find(a=>a.id==="bus-from-venue"||a.type==="bus-from-venue"),u=s.schedule.find(a=>a.id==="bus-to-venue"||a.maps?.[0]?.label?.includes("to"))?.maps?.[0],l=s.schedule.find(a=>a.id==="bus-from-venue"||a.maps?.[0]?.label?.includes("from"))?.maps?.[0],x=s.contact.find(a=>a.name.includes(s.bride.firstName)),m=s.contact.find(a=>a.name.includes(s.groom.firstName));return{busToVenue:{time:r?.time||"18:00",mainCoords:u?.coordinates||null,extraCoords:(u?.extraCoordinates||[]).map(a=>({lat:a.lat,lng:a.lng,label:a.label||"",showMarker:!0})),mapUrl:u?.mapUrl||"",showRoute:u?.showRoute||!1,label:u?.label||"Bus to Venue"},busFromVenue:{time:g?.time||"00:00",mainCoords:l?.coordinates||null,extraCoords:(l?.extraCoordinates||[]).map(a=>({lat:a.lat,lng:a.lng,label:a.label||"",showMarker:!0})),mapUrl:l?.mapUrl||"",showRoute:l?.showRoute||!1,label:l?.label||"Bus from Venue"},venueCoordinates:s.wedding.ceremony.venue.coordinates,rsvpDeadline:s.rsvp.deadline,ceremonyTime:s.wedding.ceremony.time,ceremonyVenue:s.wedding.ceremony.venue.longName,venueMapLink:s.wedding.ceremony.venue.mapLink,venueWebsite:s.wedding.ceremony.venue.website,weddingDate:{full:new Date(s.wedding.date).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),month:new Date(s.wedding.date).toLocaleDateString(void 0,{month:"long"})},brideFirstName:s.bride.firstName,bridePhone:x?.phone||"",groomFirstName:s.groom.firstName,groomPhone:m?.phone||"",airports:s.travel?.nearestAirport||[],hotels:s.travel?.hotels||[]}},[s]),v=o.useMemo(()=>i("items",{returnObjects:!0,...n})||[],[i,n]),M=o.useMemo(()=>p.qa?.questions?p.qa.questions.filter(([r,g])=>g).map(([r])=>r):[],[p.qa?.questions]),$=o.useMemo(()=>v.filter(r=>M.includes(r.id)&&(c==="all"?!0:r.category===c)),[v,c,M]),C=o.useCallback(r=>{d(g=>g===r?null:r)},[]),L=o.useCallback(r=>{h(r),d(null)},[]),D=["essentials","logistics","style","family","gifts","travel","all"];return e.jsxs("div",{className:"qa-page container",children:[e.jsx(k.h1,{className:"qa-title",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:i("title")}),e.jsx("div",{className:"qa-categories",children:D.map(r=>e.jsx(k.button,{className:`category-tab ${c===r?"active":""}`,onClick:()=>L(r),children:i(r)},r))}),e.jsx("div",{className:"qa-list",children:e.jsx(P,{mode:"popLayout",children:$.map((r,g)=>{const w=v.findIndex(t=>t.question===r.question),u=T===w;return e.jsxs(k.div,{className:"qa-item",layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsxs("button",{className:`qa-question ${u?"open":""}`,onClick:()=>C(w),children:[e.jsx("span",{children:r.question}),e.jsx(y.Down,{className:`chevron ${u?"rotate-180":""}`})]}),e.jsx(P,{children:u&&e.jsx(k.div,{className:"qa-answer",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},children:e.jsx("div",{className:"answer-content",children:e.jsx(ee,{i18nKey:`items.${w}.answer`,t:i,values:n,components:{RSVPLink:e.jsx(Z,{to:S("/rsvp"),children:i("links.goToRSVP")}),VenueLink:e.jsx("a",{href:n.venueWebsite,target:"_blank",rel:"noopener noreferrer",style:{fontWeight:"bold",textDecoration:"none",color:"inherit"},children:n.ceremonyVenue}),MapVenue:e.jsx(E,{coordinates:n.venueCoordinates,label:n.ceremonyVenue,mapUrl:n.venueMapLink,interactive:!1,zoom:12}),MapBus:e.jsx(E,{label:n.busToVenue.label,coordinates:n.busToVenue.mainCoords,extraCoordinates:n.busToVenue.extraCoords,mapUrl:n.busToVenue.mapUrl,showRoute:n.busToVenue.showRoute,interactive:!1,width:"100%",height:"400px"}),DonateButton:e.jsx(te,{}),WeatherForecast:p.weather.enabled?e.jsx(re,{}):null,SkyscannerLink:e.jsx("a",{href:"https://www.skyscanner.com/",target:"_blank",rel:"noopener noreferrer",children:i("links.skyscanner")}),AirBnbLink:e.jsx("a",{href:"https://www.airbnb.com/",target:"_blank",rel:"noopener noreferrer",children:i("links.airbnb")}),AirportsList:e.jsx("ul",{children:n.airports.map((t,l)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[t.name," (",t.code,")"]})," ","â€“"," ",i("distance",{distance:t.distance}),","," ",i("transport",{transport:t.transportOptions.join(", ")})]},l))}),HotelLinks:e.jsx("ul",{children:n.hotels.map((t,l)=>e.jsx("li",{children:e.jsxs("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",children:[t.name," â€“ ",t.address]})},l))}),strong:e.jsx("strong",{}),p:e.jsx("p",{}),br:e.jsx("br",{})}})})})})]},`${r.id}-${g}`)})})})]})},_e=X(oe);export{_e as default};
