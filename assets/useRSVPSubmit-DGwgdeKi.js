import{j as n}from"./jsx-runtime-u17CrQMm.js";import{a as d,R as We,y as ke}from"./chunk-LFPYN7LY-BSAdruXa.js";import{u as Pe}from"./lenis-react-Boms-NFb.js";import{u as Be}from"./LanguageContext-BYdMKH5j.js";import{u as Ke}from"./LayoutContext-p-UZ0jeN.js";import{I as F}from"./Icon-DOFxzM3z.js";import{m as K,A as Te}from"./Modal-CNge4sqE.js";import{u as ze}from"./useTranslation-DhuK-hdO.js";import{u as Ye}from"./AnalyticsContext-Dv958otn.js";const Ge=({player:e,onStop:r,onAdd:s,isAdded:t,canAddMore:a,formatTime:i,progressPercent:g,t:h})=>{const p=d.useRef(null),{state:{fixedOffsetY:m},actions:{setFixedOffset:x,resetFixedOffset:o}}=Ke();return e.song?(d.useEffect(()=>{if(e.song){const u=p.current?.getBoundingClientRect().height;x(u*-1)}else o();return()=>{o()}},[e,p]),n.jsxs(K.div,{ref:p,className:"mini-player",role:"region","aria-label":h("rsvp:musicRequest.nowPlayingAriaLabel"),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",stiffness:400,damping:30},children:[n.jsx(K.img,{src:e.song.artworkUrl100,alt:`${e.song.trackName} album art`,className:"mini-player__artwork",initial:{opacity:0},animate:{opacity:1},transition:{duration:.15},loading:"lazy"},e.song.artworkUrl100),n.jsxs("div",{className:"mini-player__info",children:[n.jsx(K.span,{className:"mini-player__track",initial:{opacity:0,x:6},animate:{opacity:1,x:0},transition:{duration:.15},children:e.song.trackName},`track-${e.song.trackName}`),n.jsx(K.span,{className:"mini-player__artist",initial:{opacity:0,x:6},animate:{opacity:1,x:0},transition:{duration:.15,delay:.03},children:e.song.artistName},`artist-${e.song.artistName}`),n.jsx("div",{className:"mini-player__progress-bar",role:"progressbar","aria-valuenow":g,"aria-valuemin":0,"aria-valuemax":100,children:n.jsx("div",{className:"mini-player__progress-fill",style:{width:`${g}%`}})})]}),n.jsxs("span",{className:"mini-player__time",children:[i(e.currentTime)," / ",i(e.duration)]}),n.jsxs("div",{className:"mini-player__actions",children:[n.jsx("button",{className:"mini-player__add",onClick:()=>s(e.song),disabled:t||!a,"aria-label":t?`${e.song.trackName} already added`:h("rsvp:musicRequest.addAriaLabel",{songName:e.song.trackName}),children:t?n.jsx(F.Tick,{}):n.jsx(F.Add,{})}),n.jsx("button",{className:"mini-player__stop",onClick:r,"aria-label":h("rsvp:musicRequest.stopAriaLabel",{songName:e.song.trackName}),children:n.jsx(F.Stop,{})})]})]},e.url)):null},Je=({showManualEntry:e,manualTrack:r,manualArtist:s,onManualTrackChange:t,onManualArtistChange:a,onAddManual:i,onCancel:g,onToggle:h,t:p})=>n.jsxs("div",{className:"manual-entry-form",children:[n.jsx("input",{type:"text",value:r,onChange:m=>t(m.target.value),placeholder:p("rsvp:musicRequest.manualEntry.songPlaceholder"),className:"form-input","aria-label":p("rsvp:musicRequest.manualEntry.songPlaceholder"),onKeyDown:m=>{m.key==="Enter"&&i()}}),n.jsx("input",{type:"text",value:s,onChange:m=>a(m.target.value),placeholder:p("rsvp:musicRequest.manualEntry.artistPlaceholder"),className:"form-input","aria-label":p("rsvp:musicRequest.manualEntry.artistPlaceholder"),onKeyDown:m=>{m.key==="Enter"&&i()}}),n.jsxs("div",{className:"manual-entry-actions",children:[n.jsx("button",{type:"button",className:"button",onClick:g,children:p("rsvp:musicRequest.manualEntry.cancelButton")}),n.jsx("button",{type:"button",className:"button button--primary",onClick:i,disabled:!r.trim()||!s.trim(),children:p("rsvp:musicRequest.manualEntry.addButton")})]})]}),Xe=({currentPage:e,totalPages:r,onPageChange:s})=>{const t=()=>{const i=[];for(let p=1;p<=r;p++)(p===1||p===r||p>=e-1&&p<=e+1)&&i.push(p);const g=[];let h=null;for(const p of i)h!==null&&p-h===2?g.push(h+1):h!==null&&p-h>2&&g.push("…"),g.push(p),h=p;return g};return n.jsxs("div",{className:"dd-pagination",children:[n.jsx("button",{className:"dd-pagination__btn",onClick:()=>s(e-1),disabled:e===1,"aria-label":"Previous page",children:"‹"}),t().map((a,i)=>a==="…"?n.jsx("span",{className:"dd-pagination__ellipsis",children:"…"},`ellipsis-${i}`):n.jsx("button",{className:`dd-pagination__btn${a===e?" dd-pagination__btn--active":""}`,onClick:()=>typeof a=="number"&&s(a),disabled:a===e,"aria-current":a===e?"page":void 0,children:a},a)),n.jsx("button",{className:"dd-pagination__btn",onClick:()=>s(e+1),disabled:e===r,"aria-label":"Next page",children:"›"})]})},Qe=({isOpen:e,setIsOpen:r,songQuery:s,artistQuery:t,onSongChange:a,onArtistChange:i,onClear:g,suggestions:h,isSearching:p,error:m,addedSongKeys:x,canAddMore:o,player:u,onPlayToggle:_,onAddSong:b,formatTime:R,currentPage:j,totalPages:T,itemsPerPage:v,totalItems:y,onPageChange:E,onItemsPerPageChange:c,t:S})=>{const N=d.useRef(null),O=d.useRef(null),z=d.useRef(null),[C,H]=d.useState(-1),G=Pe(),P=!!(s||t);d.useEffect(()=>{r(!!P)},[P]),d.useEffect(()=>{const l=k=>{N.current&&!N.current.contains(k.target)&&r(!1)};return document.addEventListener("pointerdown",l),()=>document.removeEventListener("pointerdown",l)},[]),d.useEffect(()=>{H(-1)},[h,j]);const I=d.useCallback(l=>{if(e){if(l.key==="ArrowDown")l.preventDefault(),H(k=>Math.min(k+1,h.length-1));else if(l.key==="ArrowUp")l.preventDefault(),H(k=>Math.max(k-1,-1));else if(l.key==="Escape")r(!1),z.current?.blur();else if(l.key==="Enter"&&C>=0){l.preventDefault();const k=h[C];k&&!x.has(k.id)&&o&&b(k)}}},[e,h,C,x,o]);return d.useEffect(()=>{C>=0&&O.current&&O.current.querySelectorAll(".dropdown-suggestion-item")[C]?.scrollIntoView({block:"nearest"})},[C]),d.useEffect(()=>{if(e&&N.current&&h.length>0){const l=setTimeout(()=>{N.current&&G?.scrollTo(N.current,{offset:document.documentElement.clientHeight/4*-1})},100);return()=>clearTimeout(l)}},[e,h]),n.jsxs("div",{className:"search-dropdown",ref:N,onKeyDown:I,children:[n.jsxs("div",{className:"search-dropdown__inputs",children:[n.jsxs("div",{className:"search-dropdown__input-wrapper",children:[n.jsx("span",{className:"search-dropdown__icon search-dropdown__icon--song",children:n.jsxs("svg",{viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M6 13V3l7-1v10"}),n.jsx("circle",{cx:"4",cy:"13",r:"2"}),n.jsx("circle",{cx:"11",cy:"12",r:"2"})]})}),n.jsx("input",{ref:z,type:"text",value:s,onChange:l=>a(l.target.value),onFocus:()=>P&&r(!0),placeholder:S("rsvp:musicRequest.searchPlaceholder.song"),className:"form-input search-dropdown__input","aria-label":S("rsvp:musicRequest.searchPlaceholder.song"),"aria-expanded":e,"aria-haspopup":"listbox","aria-autocomplete":"list",role:"combobox","aria-controls":"suggestions-listbox","aria-activedescendant":C>=0?`suggestion-item-${h[C]?.id}`:void 0}),s&&n.jsx("button",{className:"search-dropdown__clear-single",onClick:()=>a(""),"aria-label":"Clear song search",tabIndex:-1,children:"✕"})]}),n.jsxs("div",{className:"search-dropdown__input-wrapper",children:[n.jsx("span",{className:"search-dropdown__icon search-dropdown__icon--artist",children:n.jsxs("svg",{viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"8",cy:"5",r:"3"}),n.jsx("path",{d:"M2 14c0-3.314 2.686-5 6-5s6 1.686 6 5"})]})}),n.jsx("input",{type:"text",value:t,onChange:l=>i(l.target.value),onFocus:()=>P&&r(!0),placeholder:S("rsvp:musicRequest.searchPlaceholder.artist"),className:"form-input search-dropdown__input","aria-label":S("rsvp:musicRequest.searchPlaceholder.artist")}),t&&n.jsx("button",{className:"search-dropdown__clear-single",onClick:()=>i(""),"aria-label":"Clear artist search",tabIndex:-1,children:"✕"})]})]}),n.jsx(Te,{children:e&&n.jsxs(K.div,{className:"search-dropdown__panel",initial:{opacity:0,y:-6,scaleY:.97},animate:{opacity:1,y:0,scaleY:1},exit:{opacity:0,y:-6,scaleY:.97},transition:{duration:.15,ease:"easeOut"},style:{transformOrigin:"top center"},children:[y>0&&n.jsxs("div",{className:"search-dropdown__panel-header",children:[n.jsxs("span",{className:"search-dropdown__total",children:[y," ",y===1?"result":"results"]}),n.jsxs("div",{className:"search-dropdown__pagination-top",children:[T>1&&n.jsxs("div",{className:"search-dropdown__page-select",children:[n.jsx("label",{htmlFor:"dd-page-select",children:"Page"}),n.jsx("select",{id:"dd-page-select",value:j,onChange:l=>E(parseInt(l.target.value)),className:"form-select",children:Array.from({length:T},(l,k)=>k+1).map(l=>n.jsx("option",{value:l,children:l},l))})]}),n.jsx("div",{className:"search-dropdown__per-page",children:n.jsx("select",{value:v,onChange:l=>c(parseInt(l.target.value)),className:"form-select","aria-label":"Results per page",children:at.map(l=>n.jsxs("option",{value:l,children:[l," / page"]},l))})})]})]}),p&&n.jsxs("div",{role:"status","aria-live":"polite",className:"search-dropdown__status",children:[n.jsx("span",{className:"search-dropdown__spinner","aria-hidden":"true"}),S("rsvp:musicRequest.searching")]}),m&&!p&&n.jsx("div",{role:"alert",className:"search-dropdown__error",children:m}),!p&&h.length>0&&n.jsx("ul",{id:"suggestions-listbox",ref:O,className:"search-dropdown__list",role:"listbox","aria-label":"Song suggestions",children:h.map((l,k)=>{const W=x.has(l.id),D=u.url===l.previewUrl,V=k===C;return n.jsxs(K.li,{id:`suggestion-item-${l.id}`,className:`dropdown-suggestion-item${V?" dropdown-suggestion-item--active":""}${W?" dropdown-suggestion-item--added":""}`,role:"option","aria-selected":W,onMouseEnter:()=>H(k),initial:{opacity:0},animate:{opacity:1},transition:{duration:.1,delay:k*.012},children:[n.jsxs("div",{className:"dd-item__artwork",children:[n.jsx("img",{src:l.artworkUrl100,alt:"",className:"dd-item__artwork-gray",loading:"lazy"}),n.jsx("img",{src:l.artworkUrl100,alt:`${l.trackName} album art`,className:"dd-item__artwork-color",loading:"lazy"}),l.previewUrl&&n.jsx("button",{onClick:J=>{J.stopPropagation(),_(l)},className:`dd-item__play-btn${D?" dd-item__play-btn--playing":""}`,"aria-label":D?S("rsvp:musicRequest.stopAriaLabel",{songName:l.trackName}):S("rsvp:musicRequest.playAriaLabel",{songName:l.trackName}),tabIndex:-1,children:D?n.jsx(F.Stop,{}):n.jsx(F.Play,{})})]}),n.jsxs("div",{className:"dd-item__info",children:[n.jsx("span",{className:"dd-item__track",children:l.trackName}),n.jsx("span",{className:"dd-item__artist",children:l.artistName})]}),n.jsx("button",{className:"dd-item__add-btn",onClick:J=>{J.stopPropagation(),b(l)},disabled:W||!o,"aria-label":W?`${l.trackName} already added`:S("rsvp:musicRequest.addAriaLabel",{songName:l.trackName}),children:W?n.jsx(F.Tick,{}):n.jsx(F.Add,{})})]},l.id)})}),T>1&&n.jsx("div",{className:"search-dropdown__panel-footer",children:n.jsx(Xe,{currentPage:j,totalPages:T,onPageChange:E})})]})})]})},Ze=({songs:e,playerUrl:r,onPlayToggle:s,onRemove:t,t:a})=>n.jsxs("div",{className:"added-songs-section",children:[n.jsx("div",{className:"added-songs-header",children:n.jsx("span",{className:"song-count",children:a("rsvp:musicRequest.addedSongsHeader",{count:e.length,max:Y})})}),n.jsx("ul",{className:"added-songs-list",children:e.map(i=>n.jsxs("li",{className:"added-song-item",children:[n.jsxs("div",{className:"song-info",children:[n.jsx("img",{src:i.artworkUrl100,alt:`${i.trackName} album art`,className:"song-artwork-small",loading:"lazy"}),n.jsxs("div",{className:"song-text",children:[n.jsx("span",{className:"song-name",children:i.trackName}),n.jsx("span",{className:"artist-name",children:i.artistName})]})]}),n.jsxs("div",{className:"song-actions",children:[n.jsx("button",{onClick:()=>t(e.indexOf(i)),className:"remove-btn","aria-label":a("rsvp:musicRequest.removeAriaLabel",{songName:i.trackName}),children:n.jsx(F.Delete,{})}),i.previewUrl&&n.jsx("button",{onClick:()=>s(i),className:"play-btn-small","aria-label":r===i.previewUrl?a("rsvp:musicRequest.stopAriaLabel",{songName:i.trackName}):a("rsvp:musicRequest.playAriaLabel",{songName:i.trackName}),children:r===i.previewUrl?n.jsx(F.Stop,{}):n.jsx(F.Play,{})})]})]},i.id))})]}),Z={song:null,url:null,currentTime:0,duration:0,isTransitioning:!1},et="https://placehold.co/100x100?text=♪",Y=10,tt=400,rt=200,at=[20,50,100],ne={song:"songTerm",artist:"artistTerm",all:"allArtistTerm"},nt=({musicRequests:e=[],onChange:r})=>{const{locale:s}=Be(),[t,a]=d.useState(""),[i,g]=d.useState(""),[h,p]=d.useState([]),[m,x]=d.useState(20),[o,u]=d.useState(1),[_,b]=d.useState(!1),[R,j]=d.useState(Z),[T,v]=d.useState(null),[y,E]=d.useState(!1),[c,S]=d.useState(""),[N,O]=d.useState(""),[z,C]=d.useState(!1),[H,G]=d.useState(!1),{t:P}=ze(["home","common","rsvp"]),I=d.useRef(null),l=d.useRef(),k=d.useRef(),W=Pe(),D=d.useMemo(()=>new Set(e.map(f=>f.id)),[e]),V=e.length<Y,J=e.length>=Y,ve=d.useCallback(f=>{const M=Math.floor(f/60).toString().padStart(2,"0"),A=Math.floor(f%60).toString().padStart(2,"0");return`${M}:${A}`},[]),ye=d.useCallback(()=>!t&&i?ne.artist:t&&!i?ne.song:ne.all,[t,i]);d.useEffect(()=>{const f=new Audio;I.current=f;const M=()=>{j(U=>({...U,duration:f.duration,isTransitioning:!1}))},A=()=>{j(U=>({...U,currentTime:f.currentTime}))},X=()=>{j(Z)},Q=U=>{console.error("Audio error:",U),j(Z),v(P("rsvp:musicRequest.errors.playbackFailed")),setTimeout(()=>v(null),5e3)};return f.addEventListener("loadedmetadata",M),f.addEventListener("timeupdate",A),f.addEventListener("ended",X),f.addEventListener("error",Q),()=>{f.pause(),f.src="",f.load(),f.removeEventListener("loadedmetadata",M),f.removeEventListener("timeupdate",A),f.removeEventListener("ended",X),f.removeEventListener("error",Q),I.current=null}},[P]);const B=d.useCallback(()=>{I.current&&(I.current.pause(),I.current.currentTime=0),j(Z)},[]);d.useEffect(()=>{C(R.song!==null)},[R.song]),d.useEffect(()=>()=>{l.current&&clearTimeout(l.current),k.current&&k.current.abort()},[]),d.useEffect(()=>{const f=`${t} ${i}`.trim();if(l.current&&clearTimeout(l.current),k.current&&k.current.abort(),!f){p([]),v(null);return}b(!0),v(null),k.current=new AbortController;const M=ye();return l.current=setTimeout(async()=>{try{const A=new URL("https://itunes.apple.com/search");A.searchParams.append("term",f),A.searchParams.append("entity","song"),A.searchParams.append("attribute",M),A.searchParams.append("limit",rt.toString()),A.searchParams.append("lang",s);const X=await fetch(A.toString(),{signal:k.current?.signal});if(!X.ok)throw new Error("Failed to fetch songs");const Q=await X.json();p(Q.results?.map(U=>({id:String(U.trackId),trackName:U.trackName,artistName:U.artistName,artworkUrl100:U.artworkUrl100,previewUrl:U.previewUrl}))||[]),Q.results?.length===0&&v(P("rsvp:musicRequest.errors.noResults")),u(1)}catch(A){A.name!=="AbortError"&&(console.error("Search error:",A),v(P("rsvp:musicRequest.errors.searchFailed")))}finally{b(!1)}},tt),()=>{l.current&&clearTimeout(l.current)}},[t,i,P,s,ye]);const te=Math.ceil(h.length/m)||1;d.useEffect(()=>{o>te&&u(te)},[o,te]);const qe=d.useMemo(()=>{const f=(o-1)*m;return h.slice(f,f+m)},[h,o,m]),_e=d.useCallback(f=>{if(!(!f.previewUrl||!I.current)){if(R.url===f.previewUrl){B();return}I.current.pause(),I.current.src=f.previewUrl,I.current.load(),j({song:f,url:f.previewUrl,currentTime:0,duration:0,isTransitioning:!0}),I.current.play().catch(M=>{console.error("Playback failed:",M),j(Z),v(P("rsvp:musicRequest.errors.playbackFailed")),setTimeout(()=>v(null),5e3)})}},[R.url,B,P]),be=d.useCallback(f=>{!D.has(f.id)&&V&&(r([...e,f].slice(0,Y)),G(!1))},[D,V,e,r,W]),De=d.useCallback(()=>{if(!c.trim()||!N.trim()||!V)return;const f={id:crypto.randomUUID?crypto.randomUUID():`manual-${Date.now()}-${Math.random()}`,trackName:c.trim(),artistName:N.trim(),artworkUrl100:et};D.has(f.id)||r([...e,f].slice(0,Y)),S(""),O(""),E(!1)},[c,N,V,D,e,r,W]),Fe=d.useCallback(f=>{const M=[...e],A=M[f];M.splice(f,1),r(M),R.url===A?.previewUrl&&B()},[e,r,R.url,B]),He=d.useCallback(()=>{a(""),g(""),B()},[B]),Ve=R.duration>0?R.currentTime/R.duration*100:0;return d.useEffect(()=>{const f=_||!!T||h.length>0;G(f)},[]),n.jsxs("div",{className:"music-request-manager",children:[n.jsxs("div",{className:"search-label",children:[n.jsx(K.label,{className:"add-another-label",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},children:y?P("rsvp:addSong"):e.length===0?P("rsvp:searchSong"):P("rsvp:addAnother")}),!y&&n.jsx("button",{type:"button",className:"manual-entry-toggle",onClick:()=>E(!0),children:P("rsvp:musicRequest.manualEntry.toggle")})]}),y&&(t||i)&&V?n.jsx(Je,{showManualEntry:y,manualTrack:c,manualArtist:N,onManualTrackChange:S,onManualArtistChange:O,onAddManual:De,onCancel:()=>{E(!1),S(""),O("")},onToggle:()=>E(!0),t:P}):n.jsx(Qe,{isOpen:H,setIsOpen:G,songQuery:t,artistQuery:i,onSongChange:a,onArtistChange:g,onClear:He,suggestions:qe,isSearching:_,error:T,addedSongKeys:D,canAddMore:V,player:R,onPlayToggle:_e,onAddSong:be,formatTime:ve,currentPage:o,totalPages:te,itemsPerPage:m,totalItems:h.length,onPageChange:u,onItemsPerPageChange:x,t:P}),e.length>0&&n.jsx(Ze,{songs:e,playerUrl:R.url,onPlayToggle:_e,onRemove:Fe,t:P}),J&&n.jsx("div",{className:"limit-message",role:"status",children:P("rsvp:musicRequest.limitMessage",{max:Y})}),n.jsx(Te,{mode:"wait",children:z&&R.song&&n.jsx(Ge,{player:R,onStop:B,onAdd:be,isAdded:D.has(R.song.id),canAddMore:V,formatTime:ve,progressPercent:Ve,t:P})})]})},Yt=We.memo(nt);var se={exports:{}},ie,xe;function st(){if(xe)return ie;xe=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ie=e,ie}var oe,we;function it(){if(we)return oe;we=1;var e=st();function r(){}function s(){}return s.resetWarningCache=r,oe=function(){function t(g,h,p,m,x,o){if(o!==e){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}t.isRequired=t;function a(){return t}var i={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:a,element:t,elementType:t,instanceOf:a,node:t,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:s,resetWarningCache:r};return i.PropTypes=i,i},oe}var Re;function ot(){return Re||(Re=1,se.exports=it()()),se.exports}var ct=ot();const $=ke(ct);var lt=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function de(){return de=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t])}return e},de.apply(this,arguments)}function dt(e,r){if(e==null)return{};var s={},t=Object.keys(e),a,i;for(i=0;i<t.length;i++)a=t[i],!(r.indexOf(a)>=0)&&(s[a]=e[a]);return s}function re(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,ue(e,r)}function ue(e,r){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},ue(e,r)}var ae=(function(e){ut(r,e);function r(){var t;return t=e.call(this)||this,t.handleExpired=t.handleExpired.bind(re(t)),t.handleErrored=t.handleErrored.bind(re(t)),t.handleChange=t.handleChange.bind(re(t)),t.handleRecaptchaRef=t.handleRecaptchaRef.bind(re(t)),t}var s=r.prototype;return s.getCaptchaFunction=function(a){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[a]:this.props.grecaptcha[a]:null},s.getValue=function(){var a=this.getCaptchaFunction("getResponse");return a&&this._widgetId!==void 0?a(this._widgetId):null},s.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},s.execute=function(){var a=this.getCaptchaFunction("execute");if(a&&this._widgetId!==void 0)return a(this._widgetId);this._executeRequested=!0},s.executeAsync=function(){var a=this;return new Promise(function(i,g){a.executionResolve=i,a.executionReject=g,a.execute()})},s.reset=function(){var a=this.getCaptchaFunction("reset");a&&this._widgetId!==void 0&&a(this._widgetId)},s.forceReset=function(){var a=this.getCaptchaFunction("reset");a&&a()},s.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},s.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},s.handleChange=function(a){this.props.onChange&&this.props.onChange(a),this.executionResolve&&(this.executionResolve(a),delete this.executionReject,delete this.executionResolve)},s.explicitRender=function(){var a=this.getCaptchaFunction("render");if(a&&this._widgetId===void 0){var i=document.createElement("div");this._widgetId=a(i,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(i)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},s.componentDidMount=function(){this.explicitRender()},s.componentDidUpdate=function(){this.explicitRender()},s.handleRecaptchaRef=function(a){this.captcha=a},s.render=function(){var a=this.props;a.sitekey,a.onChange,a.theme,a.type,a.tabindex,a.onExpired,a.onErrored,a.size,a.stoken,a.grecaptcha,a.badge,a.hl,a.isolated;var i=dt(a,lt);return d.createElement("div",de({},i,{ref:this.handleRecaptchaRef}))},r})(d.Component);ae.displayName="ReCAPTCHA";ae.propTypes={sitekey:$.string.isRequired,onChange:$.func,grecaptcha:$.object,theme:$.oneOf(["dark","light"]),type:$.oneOf(["image","audio"]),tabindex:$.number,onExpired:$.func,onErrored:$.func,size:$.oneOf(["compact","normal","invisible"]),stoken:$.string,hl:$.string,badge:$.oneOf(["bottomright","bottomleft","inline"]),isolated:$.bool};ae.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};var ce={exports:{}},w={};var Se;function pt(){if(Se)return w;Se=1;var e=typeof Symbol=="function"&&Symbol.for,r=e?Symbol.for("react.element"):60103,s=e?Symbol.for("react.portal"):60106,t=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,i=e?Symbol.for("react.profiler"):60114,g=e?Symbol.for("react.provider"):60109,h=e?Symbol.for("react.context"):60110,p=e?Symbol.for("react.async_mode"):60111,m=e?Symbol.for("react.concurrent_mode"):60111,x=e?Symbol.for("react.forward_ref"):60112,o=e?Symbol.for("react.suspense"):60113,u=e?Symbol.for("react.suspense_list"):60120,_=e?Symbol.for("react.memo"):60115,b=e?Symbol.for("react.lazy"):60116,R=e?Symbol.for("react.block"):60121,j=e?Symbol.for("react.fundamental"):60117,T=e?Symbol.for("react.responder"):60118,v=e?Symbol.for("react.scope"):60119;function y(c){if(typeof c=="object"&&c!==null){var S=c.$$typeof;switch(S){case r:switch(c=c.type,c){case p:case m:case t:case i:case a:case o:return c;default:switch(c=c&&c.$$typeof,c){case h:case x:case b:case _:case g:return c;default:return S}}case s:return S}}}function E(c){return y(c)===m}return w.AsyncMode=p,w.ConcurrentMode=m,w.ContextConsumer=h,w.ContextProvider=g,w.Element=r,w.ForwardRef=x,w.Fragment=t,w.Lazy=b,w.Memo=_,w.Portal=s,w.Profiler=i,w.StrictMode=a,w.Suspense=o,w.isAsyncMode=function(c){return E(c)||y(c)===p},w.isConcurrentMode=E,w.isContextConsumer=function(c){return y(c)===h},w.isContextProvider=function(c){return y(c)===g},w.isElement=function(c){return typeof c=="object"&&c!==null&&c.$$typeof===r},w.isForwardRef=function(c){return y(c)===x},w.isFragment=function(c){return y(c)===t},w.isLazy=function(c){return y(c)===b},w.isMemo=function(c){return y(c)===_},w.isPortal=function(c){return y(c)===s},w.isProfiler=function(c){return y(c)===i},w.isStrictMode=function(c){return y(c)===a},w.isSuspense=function(c){return y(c)===o},w.isValidElementType=function(c){return typeof c=="string"||typeof c=="function"||c===t||c===m||c===i||c===a||c===o||c===u||typeof c=="object"&&c!==null&&(c.$$typeof===b||c.$$typeof===_||c.$$typeof===g||c.$$typeof===h||c.$$typeof===x||c.$$typeof===j||c.$$typeof===T||c.$$typeof===v||c.$$typeof===R)},w.typeOf=y,w}var Ne;function mt(){return Ne||(Ne=1,ce.exports=pt()),ce.exports}var le,je;function ht(){if(je)return le;je=1;var e=mt(),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},t={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},i={};i[e.ForwardRef]=t,i[e.Memo]=a;function g(b){return e.isMemo(b)?a:i[b.$$typeof]||r}var h=Object.defineProperty,p=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,x=Object.getOwnPropertyDescriptor,o=Object.getPrototypeOf,u=Object.prototype;function _(b,R,j){if(typeof R!="string"){if(u){var T=o(R);T&&T!==u&&_(b,T,j)}var v=p(R);m&&(v=v.concat(m(R)));for(var y=g(b),E=g(R),c=0;c<v.length;++c){var S=v[c];if(!s[S]&&!(j&&j[S])&&!(E&&E[S])&&!(y&&y[S])){var N=x(R,S);try{h(b,S,N)}catch{}}}}return b}return le=_,le}var ft=ht();const gt=ke(ft);function pe(){return pe=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t])}return e},pe.apply(this,arguments)}function vt(e,r){if(e==null)return{};var s={},t=Object.keys(e),a,i;for(i=0;i<t.length;i++)a=t[i],!(r.indexOf(a)>=0)&&(s[a]=e[a]);return s}function yt(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.__proto__=r}var q={},_t=0;function bt(e,r){return r=r||{},function(t){var a=t.displayName||t.name||"Component",i=(function(h){yt(p,h);function p(x,o){var u;return u=h.call(this,x,o)||this,u.state={},u.__scriptURL="",u}var m=p.prototype;return m.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+_t++),this.__scriptLoaderID},m.setupScriptURL=function(){return this.__scriptURL=typeof e=="function"?e():e,this.__scriptURL},m.asyncScriptLoaderHandleLoad=function(o){var u=this;this.setState(o,function(){return u.props.asyncScriptOnLoad&&u.props.asyncScriptOnLoad(u.state)})},m.asyncScriptLoaderTriggerOnScriptLoaded=function(){var o=q[this.__scriptURL];if(!o||!o.loaded)throw new Error("Script is not loaded.");for(var u in o.observers)o.observers[u](o);delete window[r.callbackName]},m.componentDidMount=function(){var o=this,u=this.setupScriptURL(),_=this.asyncScriptLoaderGetScriptLoaderID(),b=r,R=b.globalName,j=b.callbackName,T=b.scriptId;if(R&&typeof window[R]<"u"&&(q[u]={loaded:!0,observers:{}}),q[u]){var v=q[u];if(v&&(v.loaded||v.errored)){this.asyncScriptLoaderHandleLoad(v);return}v.observers[_]=function(N){return o.asyncScriptLoaderHandleLoad(N)};return}var y={};y[_]=function(N){return o.asyncScriptLoaderHandleLoad(N)},q[u]={loaded:!1,observers:y};var E=document.createElement("script");E.src=u,E.async=!0;for(var c in r.attributes)E.setAttribute(c,r.attributes[c]);T&&(E.id=T);var S=function(O){if(q[u]){var z=q[u],C=z.observers;for(var H in C)O(C[H])&&delete C[H]}};j&&typeof window<"u"&&(window[j]=function(){return o.asyncScriptLoaderTriggerOnScriptLoaded()}),E.onload=function(){var N=q[u];N&&(N.loaded=!0,S(function(O){return j?!1:(O(N),!0)}))},E.onerror=function(){var N=q[u];N&&(N.errored=!0,S(function(O){return O(N),!0}))},document.body.appendChild(E)},m.componentWillUnmount=function(){var o=this.__scriptURL;if(r.removeOnUnmount===!0)for(var u=document.getElementsByTagName("script"),_=0;_<u.length;_+=1)u[_].src.indexOf(o)>-1&&u[_].parentNode&&u[_].parentNode.removeChild(u[_]);var b=q[o];b&&(delete b.observers[this.asyncScriptLoaderGetScriptLoaderID()],r.removeOnUnmount===!0&&delete q[o])},m.render=function(){var o=r.globalName,u=this.props;u.asyncScriptOnLoad;var _=u.forwardedRef,b=vt(u,["asyncScriptOnLoad","forwardedRef"]);return o&&typeof window<"u"&&(b[o]=typeof window[o]<"u"?window[o]:void 0),b.ref=_,d.createElement(t,b)},p})(d.Component),g=d.forwardRef(function(h,p){return d.createElement(i,pe({},h,{forwardedRef:p}))});return g.displayName="AsyncScriptLoader("+a+")",g.propTypes={asyncScriptOnLoad:$.func},gt(g,t)}}var me="onloadcallback",xt="grecaptcha";function he(){return typeof window<"u"&&window.recaptchaOptions||{}}function wt(){var e=he(),r=e.useRecaptchaNet?"recaptcha.net":"www.google.com";return e.enterprise?"https://"+r+"/recaptcha/enterprise.js?onload="+me+"&render=explicit":"https://"+r+"/recaptcha/api.js?onload="+me+"&render=explicit"}const Gt=bt(wt,{callbackName:me,globalName:xt,attributes:he().nonce?{nonce:he().nonce}:{}})(ae);class ee{constructor(r=0,s="Network Error"){this.status=r,this.text=s}}const Rt=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,r)=>Promise.resolve(localStorage.setItem(e,r)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},L={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:Rt()},ge=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},St=(e,r="https://api.emailjs.com")=>{if(!e)return;const s=ge(e);L.publicKey=s.publicKey,L.blockHeadless=s.blockHeadless,L.storageProvider=s.storageProvider,L.blockList=s.blockList,L.limitRate=s.limitRate,L.origin=s.origin||r},Le=async(e,r,s={})=>{const t=await fetch(L.origin+e,{method:"POST",headers:s,body:r}),a=await t.text(),i=new ee(t.status,a);if(t.ok)return i;throw i},Ae=(e,r,s)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!r||typeof r!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!s||typeof s!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Nt=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},Ce=e=>e.webdriver||!e.languages||e.languages.length===0,Oe=()=>new ee(451,"Unavailable For Headless Browser"),jt=(e,r)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof r!="string")throw"The BlockList watchVariable has to be a string"},Et=e=>!e.list?.length||!e.watchVariable,kt=(e,r)=>e instanceof FormData?e.get(r):e[r],$e=(e,r)=>{if(Et(e))return!1;jt(e.list,e.watchVariable);const s=kt(r,e.watchVariable);return typeof s!="string"?!1:e.list.includes(s)},Ie=()=>new ee(403,"Forbidden"),Pt=(e,r)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(r&&typeof r!="string")throw"The LimitRate ID has to be a non-empty string"},Tt=async(e,r,s)=>{const t=Number(await s.get(e)||0);return r-Date.now()+t},Me=async(e,r,s)=>{if(!r.throttle||!s)return!1;Pt(r.throttle,r.id);const t=r.id||e;return await Tt(t,r.throttle,s)>0?!0:(await s.set(t,Date.now().toString()),!1)},Ue=()=>new ee(429,"Too Many Requests"),Lt=async(e,r,s,t)=>{const a=ge(t),i=a.publicKey||L.publicKey,g=a.blockHeadless||L.blockHeadless,h=a.storageProvider||L.storageProvider,p={...L.blockList,...a.blockList},m={...L.limitRate,...a.limitRate};return g&&Ce(navigator)?Promise.reject(Oe()):(Ae(i,e,r),Nt(s),s&&$e(p,s)?Promise.reject(Ie()):await Me(location.pathname,m,h)?Promise.reject(Ue()):Le("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:i,service_id:e,template_id:r,template_params:s}),{"Content-type":"application/json"}))},At=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Ct=e=>typeof e=="string"?document.querySelector(e):e,Ot=async(e,r,s,t)=>{const a=ge(t),i=a.publicKey||L.publicKey,g=a.blockHeadless||L.blockHeadless,h=L.storageProvider||a.storageProvider,p={...L.blockList,...a.blockList},m={...L.limitRate,...a.limitRate};if(g&&Ce(navigator))return Promise.reject(Oe());const x=Ct(s);Ae(i,e,r),At(x);const o=new FormData(x);return $e(p,o)?Promise.reject(Ie()):await Me(location.pathname,m,h)?Promise.reject(Ue()):(o.append("lib_version","4.4.1"),o.append("service_id",e),o.append("template_id",r),o.append("user_id",i),Le("/api/v1.0/email/send-form",o))},fe={init:St,send:Lt,sendForm:Ot,EmailJSResponseStatus:ee},$t="gVksEDEDoKBjB0TJU",Ee="service_vvuhisc",It="template_4m25aki",Mt="template_g1m154k",Ut="template_u0pm2au";fe.init($t);function Jt(e,r,s=0){const t=Ye(),[a,i]=d.useState(!1),[g,h]=d.useState(!1),[p,m]=d.useState(null),x=async()=>{if(console.log("Submitting RSVP...",{form:e,captchaToken:r}),!e.termsAccepted){const o="Please accept the Terms & Conditions and Privacy Policy.";m(o),t.event("rsvp_submit_error",{event_label:"validation_error",error_message:o,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!!r});return}if(!r){const o="Please complete reCAPTCHA.";m(o),t.event("rsvp_submit_error",{event_label:"validation_error",error_message:o,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!1});return}if(!e.email){const o="Email is required.";m(o),t.event("rsvp_submit_error",{event_label:"validation_error",error_message:o,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!!r});return}if(!e.attending){const o="Please indicate if you're attending.";m(o),t.event("rsvp_submit_error",{event_label:"validation_error",error_message:o,error_type:"validation_error",current_step:s,has_captcha_token:!!r});return}if(e.attending==="yes"&&e.guests.length===0){const o="Please add at least one guest.";m(o),t.event("rsvp_submit_error",{event_label:"validation_error",error_message:o,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!!r});return}if(e.attending==="no"&&!e.nonAttendingName){const o="Please provide your name.";m(o),t.event("rsvp_submit_error",{event_label:"validation_error",error_message:o,error_type:"validation_error",current_step:s,attending_status:e.attending,has_captcha_token:!!r});return}i(!0),m(null);try{const o=e.attending==="yes"?e.guests.map((v,y)=>`${y+1}. ${v.firstName} ${v.lastName}`+(v.dietary?` - Dietary: ${v.dietary}`:"")+(v.note?` - Note: ${v.note}`:"")).join(`
`):`Not attending: ${e.nonAttendingName}`,u=(()=>{if(!e.musicRequest)return"None";const v=e.musicRequest;return!Array.isArray(v)||v.length===0?"None":v.map((y,E)=>`${E+1}. ${y.trackName} — ${y.artistName}`).join(`
`)})(),_={email:e.email,attending:e.attending,guestsCount:e.attending==="yes"?e.guests.length:1,guests:o,notes:e.notes||"None",musicRequest:u,termsAccepted:e.termsAccepted?"Yes — Terms & Conditions and Privacy Policy accepted":"No",recaptchaToken:r};console.log("Sending email with params:",_);const b=await fe.send(Ee,It,_);console.log("Notification sent:",b);const j=(document.documentElement.lang??"es")==="en"?Mt:Ut,T=await fe.send(Ee,j,_);console.log("Auto-reply sent:",T),t.event("rsvp_submit_success",{event_label:`RSVP ${e.attending==="yes"?"Accepted":"Declined"}`,attending:e.attending,guest_count:e.attending==="yes"?e.guests.length:1,dietary_requirements:e.guests[0]?.dietary||"none",music_request:u,terms_accepted:!0,locale:document.documentElement.lang}),t.event("conversion",{event_label:"RSVP Completed",send_to:"AW-CONVERSION-ID"}),t.event("rsvp_confirmation_view",{event_label:"Viewed confirmation page"}),t.event("page_view",{page_title:"RSVP Confirmation",page_location:window.location.href,page_path:"/rsvp/confirmation"}),h(!0)}catch(o){console.error("Submission error:",o);const u=o?.text||o?.message||"Failed to submit RSVP. Please try again.",_=o?.text?"emailjs_error":"network_error";m(u),t.event("rsvp_submit_error",{event_label:_,error_message:u,error_type:_,current_step:s,attending_status:e.attending,has_captcha_token:!!r}),t.event("exception",{description:`RSVP Error: ${_} - ${u}`,fatal:!1})}finally{i(!1)}};return d.useEffect(()=>{p&&console.error("RSVP Error:",p)},[p]),{submit:x,sending:a,submitted:g,error:p,setError:m,setSubmitted:h}}export{Yt as M,Gt as R,Jt as u};
