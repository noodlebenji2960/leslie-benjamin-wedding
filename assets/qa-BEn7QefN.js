import{a as i,w as X}from"./chunk-EPOLDU6W-C9vtjoJn.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{I as v}from"./Icon-fSrDZDb7.js";import{u as P}from"./useWeddingData-DmPkR6aw.js";import{m as N,A as O,T as Z}from"./Modal-Sal8OyIs.js";import{M as V}from"./Map-DFeI_dnp.js";import{D as ee}from"./DonateButton-Cmwhl_YA.js";import{u as te}from"./ConfigContext-C6aNWQqm.js";import{u as ae}from"./useTranslation-DvHpW7Xw.js";import"./i18next-BDvusv7y.js";import"./lenis-react-DQp2-cqK.js";const z=(h,c)=>h>60?v.Rain:h>30?v.Cloud:c<=0?v.Snow:v.Sun,ne=({test:h})=>{console.log("WeatherForecast rendered with test =",h);const c=P(),{lat:D,lng:n}=c.wedding.ceremony.venue.coordinates,m=i.useMemo(()=>new Date(c.wedding.date),[c.wedding.date]),[g,$]=i.useState([]),[u,o]=i.useState(null),[l,M]=i.useState(null),[C,S]=i.useState(!0),[L,q]=i.useState(!1),t=a=>a.toISOString().split("T")[0],d=a=>a.toLocaleDateString(void 0,{month:"short",day:"numeric"}),f=i.useMemo(()=>{if(!g.length)return"";const a=new Date(g[0].rawDate),x=new Date(g[g.length-1].rawDate),j=`${a.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}, ${a.getFullYear()}`,p=`${x.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}, ${x.getFullYear()}`;return`${j} â€“ ${p}`},[g]),r=i.useMemo(()=>{if(!u)return"";const[a,x]=u.measuredRange.split(" â€“ ");return`${a}, ${m.getFullYear()-1} â€“ ${x}, ${m.getFullYear()-1}`},[u,m]),w=i.useMemo(()=>l?`${l.date}, ${l.year}`:"",[l]);return i.useEffect(()=>{let a=!1;return(async()=>{try{const j=`https://api.open-meteo.com/v1/forecast?latitude=${D}&longitude=${n}&daily=temperature_2m_max,precipitation_probability_max&timezone=auto`,p=m.getFullYear()-1,s=m.getMonth(),_=new Date(p,s,1),I=new Date(p,s+1,0),J=`https://archive-api.open-meteo.com/v1/archive?latitude=${D}&longitude=${n}&start_date=${t(_)}&end_date=${t(I)}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=auto`,[W,R]=await Promise.all([fetch(j),fetch(J)]);if(!W.ok||!R.ok)throw new Error("Weather fetch failed");const T=await W.json(),b=await R.json();if(a)return;const Q=T.daily.time.slice(0,7).map((y,k)=>({rawDate:y,date:new Date(y).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"}),temp:Math.round(T.daily.temperature_2m_max[k]),precipitation:Math.round(T.daily.precipitation_probability_max?.[k]??0)}));$(Q);const Y=b.daily.temperature_2m_max,H=b.daily.temperature_2m_min,A=b.daily.precipitation_sum,U=A.length,B=A.filter(y=>y>1).length,K=U-B;o({avgTemp:Math.round((y=>y.reduce((k,G)=>k+G,0)/y.length)(Y)),maxTemp:Math.round(Math.max(...Y)),minTemp:Math.round(Math.min(...H)),rainyDays:B,sunnyDays:K,totalDays:U,measuredRange:`${d(_)} â€“ ${d(I)}`});const E=t(new Date(p,s,m.getDate())),F=b.daily.time.findIndex(y=>y===E);F>=0&&M({temp:Math.round(b.daily.temperature_2m_max[F]),precipitation:Math.round(b.daily.precipitation_sum[F]),date:d(new Date(E)),year:p})}catch{a||q(!0)}finally{a||S(!1)}})(),()=>{a=!0}},[D,n,m]),C?e.jsxs("div",{className:"weather-forecast loading",children:[e.jsx(v.More,{className:"loading-spinner"}),e.jsx("p",{children:"Loading weatherâ€¦"})]}):L?e.jsxs("div",{className:"weather-forecast error",children:[e.jsx(v.Cloud,{}),e.jsx("p",{children:e.jsx("strong",{children:"Weather unavailable"})}),e.jsx("small",{children:"Typical summer weather: warm & sunny â˜€ï¸"})]}):e.jsxs(N.div,{className:"weather-forecast compact",initial:{opacity:0},animate:{opacity:1},children:[g.length>0&&e.jsx("strong",{children:f}),e.jsx("div",{className:"weather-forecast__forecast",children:g.slice(0,5).map((a,x)=>{const j=z(a.precipitation,a.temp),p=new Date,s=new Date(a.rawDate),_=p.getFullYear()===s.getFullYear()&&p.getMonth()===s.getMonth()&&p.getDate()===s.getDate();return e.jsxs("div",{className:`weather-day${_?" today":""}`,children:[e.jsxs("div",{className:"date",children:[e.jsx("div",{className:"icon",children:e.jsx(j,{size:18})}),a.date," ",_&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"(today)"]})]}),e.jsxs("div",{children:[a.precipitation>30&&e.jsxs("div",{className:"rain",children:[a.precipitation,"% prec."]}),e.jsxs("div",{className:"temp",children:[a.temp,"Â°"]})]})]},x)})}),l&&e.jsxs("div",{className:"weather-forecast__wedding-day",children:[e.jsxs("strong",{children:[w,":"]}),e.jsx("div",{className:"icon",children:z(l.precipitation,l.temp)({size:18})}),e.jsxs("span",{children:[l.temp,"Â°"]}),l.precipitation>0&&e.jsxs("span",{children:[" â€¢ ðŸ’§ ",l.precipitation,"mm"]})]}),u&&e.jsxs("div",{className:"weather-forecast__typical",children:[e.jsx("small",{children:r}),e.jsxs("span",{children:["ðŸŒ§ ",u.rainyDays," rainy days â€¢ â˜€ï¸ ",u.sunnyDays," sunny days"]}),e.jsxs("span",{children:["ðŸŒ¡ ",u.avgTemp,"Â°C avg / ",u.maxTemp,"Â° / ",u.minTemp,"Â°"]})]})]})},se=()=>{const h=te(),{t:c,ready:D}=ae("qa"),n=P(),[m,g]=i.useState("essentials"),[$,u]=i.useState(null);if(!D)return e.jsx("div",{className:"loading",children:c("loading","Loading...")});const o=i.useMemo(()=>{const t=n.schedule.find(s=>s.id==="bus"),d=n.contact.find(s=>s.name.includes(n.bride.firstName)),f=n.contact.find(s=>s.name.includes(n.groom.firstName)),r=n.schedule.find(s=>s.id==="bus"),w=r?.maps[1]?.coordinates||null,a=r?.maps[1]?.extraCoordinates||[],x=r?.maps[1]?.mapUrl||"",j=r?.maps[1]?.showRoute||!1,p=r?.maps[1]?.label||"Bus Route";return{bus:{mainCoords:w,extraCoords:a.map(s=>({lat:s.lat,lng:s.lng,label:s.label||"",showMarker:!0})),mapUrl:x,showRoute:j,label:p},venueCoordinates:n.wedding.ceremony.venue.coordinates,rsvpDeadline:n.rsvp.deadline,ceremonyTime:n.wedding.ceremony.time,ceremonyVenue:n.wedding.ceremony.venue.longName,venueMapLink:n.wedding.ceremony.venue.mapLink,venueWebsite:n.wedding.ceremony.venue.website,busTime:t?.time||"13:00",weddingDate:new Date(n.wedding.date).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),brideFirstName:n.bride.firstName,bridePhone:d?.phone||"",groomFirstName:n.groom.firstName,groomPhone:f?.phone||"",airports:n.travel?.nearestAirport||[],hotels:n.travel?.hotels||[]}},[n]),l=i.useMemo(()=>c("items",{returnObjects:!0,...o})||[],[c,o]),M=i.useMemo(()=>h.qa?.questions?h.qa.questions.filter(([t,d])=>d).map(([t])=>t):[],[h.qa?.questions]),C=i.useMemo(()=>l.filter(t=>M.includes(t.id)&&(m==="all"?!0:t.category===m)),[l,m,M]),S=i.useCallback(t=>{u(d=>d===t?null:t)},[]),L=i.useCallback(t=>{g(t),u(null)},[]),q=["essentials","logistics","style","family","gifts","travel","all"];return e.jsxs("div",{className:"qa-page container",children:[e.jsx(N.h1,{className:"qa-title",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:c("title")}),e.jsx("div",{className:"qa-categories",children:q.map(t=>e.jsx(N.button,{className:`category-tab ${m===t?"active":""}`,onClick:()=>L(t),children:c(t)},t))}),e.jsx("div",{className:"qa-list",children:e.jsx(O,{mode:"popLayout",children:C.map(t=>{const d=l.findIndex(r=>r.question===t.question),f=$===d;return e.jsxs(N.div,{className:"qa-item",layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsxs("button",{className:`qa-question ${f?"open":""}`,onClick:()=>S(d),children:[e.jsx("span",{children:t.question}),e.jsx(v.Down,{className:`chevron ${f?"rotate-180":""}`})]}),e.jsx(O,{children:f&&e.jsx(N.div,{className:"qa-answer",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},children:e.jsx("div",{className:"answer-content",children:e.jsx(Z,{i18nKey:`items.${d}.answer`,t:c,values:o,components:{VenueLink:e.jsx("a",{href:o.venueWebsite,target:"_blank",rel:"noopener noreferrer",style:{fontWeight:"bold",textDecoration:"none",color:"inherit"},children:o.ceremonyVenue}),MapVenue:e.jsx(V,{coordinates:o.venueCoordinates,label:o.ceremonyVenue,mapUrl:o.venueMapLink,interactive:!1,zoom:12}),MapBus:e.jsx(V,{label:o.bus.label,coordinates:o.bus.mainCoords,extraCoordinates:o.bus.extraCoords,mapUrl:o.bus.mapUrl,showRoute:o.bus.showRoute,interactive:!1,width:"100%",height:"400px"}),DonateButton:e.jsx(ee,{}),WeatherForecast:h.weather.enabled?e.jsx(ne,{}):e.jsx(e.Fragment,{}),SkyscannerLink:e.jsx("a",{href:"https://www.skyscanner.com/",target:"_blank",rel:"noopener noreferrer",children:c("links.skyscanner","Skyscanner")}),AirBnbLink:e.jsx("a",{href:"https://www.airbnb.com/",target:"_blank",rel:"noopener noreferrer",children:c("links.airbnb","AirBnB")}),AirportsList:e.jsx("ul",{children:o.airports.map((r,w)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[r.name," (",r.code,")"]})," ","â€“ ",c("distance",{distance:r.distance}),","," ",c("transport",{transport:r.transportOptions.join(", ")})]},w))}),HotelLinks:e.jsx("ul",{children:o.hotels.map((r,w)=>e.jsx("li",{children:e.jsxs("a",{href:r.website,target:"_blank",rel:"noopener noreferrer",children:[r.name," â€“ ",r.address]})},w))}),strong:e.jsx("strong",{}),p:e.jsx("p",{}),br:e.jsx("br",{})}})})})})]},t.question)})})})]})},ye=X(se);export{ye as default};
