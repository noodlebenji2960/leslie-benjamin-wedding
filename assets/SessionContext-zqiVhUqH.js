import{j as p}from"./jsx-runtime-u17CrQMm.js";import{a as e,x as C,p as E}from"./chunk-EPOLDU6W-BnKKP6Ue.js";import{u as V}from"./useTranslation-B9zSoiKr.js";const h=e.createContext(void 0);function R({children:t}){const g=C(),r=E(),{i18n:a}=V(),[c,l]=e.useState(!1),i=(s=>s.startsWith("/en")?"en":(s.startsWith("/es"),"es"))(r.pathname);e.useEffect(()=>{a.language!==i&&a.changeLanguage(i)},[i,a]);const o=()=>{l(!0);const s=i==="es"?"en":"es";localStorage.setItem("preferred-language",s);const u=r.pathname.replace(/^\/(en|es)/,"")||"/";g(`/${s}${u}`,{replace:!0}),l(!1)};return p.jsx(h.Provider,{value:{locale:i,switchLanguage:o,isPending:c},children:t})}function y(){const t=e.useContext(h);if(!t)throw new Error("useLanguage must be used within a LanguageProvider");return t}const w="wedding_visitor_id",S="wedding_last_visit",f="wedding_visit_count",v="wedding_cookie_pref",b=3e4,_=e.createContext(null),M=({children:t})=>{const g=e.useRef(Date.now()),r=e.useRef(null),[a,c]=e.useState(null),[l,d]=e.useState(null),i=o=>{typeof window<"u"&&localStorage.setItem(v,JSON.stringify(o)),d(o),console.debug("[Session] Cookie preference updated:",o)};return e.useEffect(()=>{if(typeof window>"u")return;const o=localStorage.getItem(v);o&&d(JSON.parse(o));const s=navigator.userAgent,u=/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(s)?"tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(s)?"mobile":"desktop",m=localStorage.getItem(w),L=localStorage.getItem(S),P=parseInt(localStorage.getItem(f)||"0");if(m){const n=parseInt(L||"0"),x=Math.floor((Date.now()-n)/(1e3*60*60*24)),I=P+1;localStorage.setItem(S,Date.now().toString()),localStorage.setItem(f,I.toString()),c({visitorId:m,isFirstVisit:!1,isReturningVisitor:!0,daysSinceLastVisit:x,visitCount:I,deviceType:u,timeOnSite:0,lastVisitTime:n})}else{const n=`visitor_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;localStorage.setItem(w,n),localStorage.setItem(S,Date.now().toString()),localStorage.setItem(f,"1"),c({visitorId:n,isFirstVisit:!0,isReturningVisitor:!1,daysSinceLastVisit:0,visitCount:1,deviceType:u,timeOnSite:0,lastVisitTime:null})}return r.current=setInterval(()=>{c(n=>n?{...n,timeOnSite:Math.floor((Date.now()-g.current)/1e3)}:null)},b),()=>{r.current&&clearInterval(r.current)}},[]),p.jsx(_.Provider,{value:{visitor:a,cookiePreference:l,setCookiePreference:i},children:t})},D=()=>{const t=e.useContext(_);if(!t)throw new Error("useSession must be used within a SessionProvider");return t};export{R as L,M as S,_ as a,D as b,y as u};
