import{j as b}from"./jsx-runtime-u17CrQMm.js";import{a as e}from"./chunk-LFPYN7LY-BSAdruXa.js";const g="wedding_visitor_id",r="wedding_last_visit",a="wedding_visit_count",I="wedding_cookie_pref",C=3e4,f=e.createContext(null),k=({children:i})=>{const m=e.useRef(Date.now()),s=e.useRef(null),[w,n]=e.useState(null),[v,l]=e.useState(null),_=o=>{typeof window<"u"&&localStorage.setItem(I,JSON.stringify(o)),l(o),console.debug("[Session] Cookie preference updated:",o)};return e.useEffect(()=>{if(typeof window>"u")return;const o=localStorage.getItem(I);o&&l(JSON.parse(o));const c=navigator.userAgent,u=/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(c)?"tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(c)?"mobile":"desktop",S=localStorage.getItem(g),p=localStorage.getItem(r),V=parseInt(localStorage.getItem(a)||"0");if(S){const t=parseInt(p||"0"),E=Math.floor((Date.now()-t)/(1e3*60*60*24)),d=V+1;localStorage.setItem(r,Date.now().toString()),localStorage.setItem(a,d.toString()),n({visitorId:S,isFirstVisit:!1,isReturningVisitor:!0,daysSinceLastVisit:E,visitCount:d,deviceType:u,timeOnSite:0,lastVisitTime:t})}else{const t=`visitor_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;localStorage.setItem(g,t),localStorage.setItem(r,Date.now().toString()),localStorage.setItem(a,"1"),n({visitorId:t,isFirstVisit:!0,isReturningVisitor:!1,daysSinceLastVisit:0,visitCount:1,deviceType:u,timeOnSite:0,lastVisitTime:null})}return s.current=setInterval(()=>{n(t=>t?{...t,timeOnSite:Math.floor((Date.now()-m.current)/1e3)}:null)},C),()=>{s.current&&clearInterval(s.current)}},[]),b.jsx(f.Provider,{value:{visitor:w,cookiePreference:v,setCookiePreference:_},children:i})},x=()=>{const i=e.useContext(f);if(!i)throw new Error("useSession must be used within a SessionProvider");return i};export{k as S,f as a,x as u};
